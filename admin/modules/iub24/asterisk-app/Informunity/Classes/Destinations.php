<?php
 namespace Informunity\Classes; class Destinations { public $Destinations; private $config; private $modules; private $IRD; public function __construct($config) { goto cnWqI; Bmnk9: $this->modules = empty($_SESSION["\x61\143\x74\x69\x76\145\137\x6d\x6f\x64\x75\154\x65\x73"]) ? \FreePBX::Modules()->getActiveModules() : $_SESSION["\x61\x63\x74\x69\166\x65\137\x6d\x6f\144\165\x6c\x65\163"]; goto JAAst; JAAst: $this->getDestinations(); goto bATDq; cnWqI: $this->config = $config; goto PVdsZ; PVdsZ: $this->IRD = $this->getIRDestinations(); goto Bmnk9; bATDq: $this->MakeCollection(); goto p27Vl; p27Vl: } public function returnUsage($did) { goto R9AtV; AdMy_: JpRll: goto PdbLG; MCO7n: if (!(!empty($this->Destinations) && is_array($this->Destinations))) { goto pK1MY; } goto GqfH5; nX12t: $usage_items["\165\162\154"] = ''; goto sceR6; csyq9: FFi6w: goto zmF2I; M86tF: foreach ($this->IRD[$did] as $route) { goto DjHEP; BwoGx: pogWF: goto r1d62; DjHEP: $thisid = $route["\145\x78\164\145\x6e\x73\x69\x6f\x6e"] . "\57" . $route["\x63\151\144\156\x75\x6d"]; goto ztYnt; KiGM8: $usage_items["\x75\162\154"] .= sprintf("\74\141\x20\x68\x72\145\146\75\x25\x73\76\45\163\74\x2f\141\76\x3c\x62\162\x3e", "\x63\x6f\156\x66\x69\x67\56\160\150\160\x3f\144\x69\163\x70\x6c\141\x79\75\144\x69\x64\x26\166\151\x65\167\75\x66\x6f\x72\155\46\145\170\164\x64\x69\x73\x70\154\141\x79\75" . urlencode($thisid), htmlspecialchars("\x49\x6e\142\x6f\165\x6e\144\x20\122\157\x75\x74\x65\x3a\40" . $thisid)); goto BwoGx; ztYnt: $usage_items["\151\x74\145\155\x73"][] = $route; goto KiGM8; r1d62: } goto csyq9; SeaNC: LhGpX: goto FxcIQ; sceR6: if (!(!empty($this->IRD[$did]) && is_array($this->IRD[$did]))) { goto mQWvj; } goto M86tF; R9AtV: if (!(isset($this->config["\143\150\x65\x63\153\x44\x50"]) && $this->config["\143\150\145\x63\x6b\x44\x50"] == 1)) { goto JpRll; } goto bgcdN; PdbLG: return array(); goto W9MCn; bgcdN: $usage_items = array("\151\164\145\155\163", "\165\x72\154"); goto nX12t; FxcIQ: pK1MY: goto zDHOo; GqfH5: foreach ($this->Destinations as $dst) { goto xJlpA; Pwxgn: KrOon: goto On7bW; eqi46: x3ASK: goto Pwxgn; ef5dS: $usage_items["\151\x74\x65\x6d\x73"][] = $dst; goto WH6H4; xJlpA: if (!(!empty($dst->destinations) && is_array($dst->destinations) && in_array($did, $dst->destinations))) { goto x3ASK; } goto ef5dS; WH6H4: $usage_items["\165\x72\154"] .= empty($dst->edit_url) ? sprintf("\45\x73\x3c\x62\162\76", htmlspecialchars($dst->name . "\72\x20" . $dst->description)) : sprintf("\74\141\x20\150\x72\145\146\x3d\x25\163\76\45\x73\x3c\x2f\141\x3e\74\142\x72\76", $dst->edit_url, htmlspecialchars($dst->name . "\72\40" . $dst->description)); goto eqi46; On7bW: } goto SeaNC; zmF2I: mQWvj: goto MCO7n; zDHOo: return $usage_items; goto AdMy_; W9MCn: } public function getDestinations() { goto Q72B2; Q72B2: if (!(!empty($this->modules) && is_array($this->modules))) { goto D7etn; } goto A2v_d; A2v_d: \FreePBX::Modules()->loadAllFunctionsInc(); goto Zf20c; bV0_Q: CAHvo: goto N1tzY; Zf20c: foreach ($this->modules as $module) { try { goto udk_t; Ge635: if (!(!empty($ModuleDestinations) && is_array($ModuleDestinations))) { goto UaVeJ; } goto lI3Nd; udk_t: $ModuleDestinations = $this->getModDest($module["\162\x61\167\156\141\x6d\x65"]); goto Ge635; POP90: SlOUL: goto Nh03V; Nh03V: UaVeJ: goto tAEDv; lI3Nd: foreach ($ModuleDestinations as $dst) { goto u1WFS; u1WFS: $funct2 = strtolower($module["\x72\141\167\x6e\141\155\x65"] . "\137\147\x65\x74\144\145\163\164\x69\156\146\157"); goto yINw2; o1_P2: $this->Destinations[$dst["\x64\x65\x73\164\151\x6e\x61\164\x69\157\156"]] = new Destination($dst); goto ZeWGa; qhbFK: $dst["\145\x64\x69\164\137\x75\x72\154"] = isset($info["\x65\144\151\x74\x5f\165\x72\x6c"]) ? $info["\145\x64\x69\164\137\x75\x72\154"] : ''; goto Y1NGp; ZeWGa: LtRHk: goto ff0kL; r5Zvu: $info = $funct2($dst["\x64\145\163\164\151\x6e\x61\x74\151\x6f\x6e"]); goto qhbFK; mMr3y: $dst["\155\157\x64\165\x6c\145"] = $module["\x72\x61\167\156\141\155\x65"]; goto o1_P2; yINw2: if (!function_exists($funct2)) { goto oYRNq; } goto r5Zvu; L8nKr: $dst["\x6e\x61\x6d\x65"] = $module["\156\141\x6d\x65"]; goto mMr3y; Y1NGp: oYRNq: goto L8nKr; ff0kL: } goto POP90; tAEDv: } catch (\Exception $e) { unset($e); } rWnR1: } goto bV0_Q; N1tzY: D7etn: goto Zay6k; Zay6k: } public function getModDest($module, $index = '') { goto DSPFk; XKUjL: return false; goto zul5J; DSPFk: \FreePBX::Modules()->loadFunctionsInc($module); goto rBcZS; rBcZS: $funct = strtolower($module . "\137\x64\145\163\x74\x69\156\141\x74\151\x6f\x6e\163"); goto uAzIx; UNU4E: zQ7IG: goto XKUjL; uAzIx: if (!function_exists($funct)) { goto zQ7IG; } goto RDXPj; RDXPj: return $funct($index); goto UNU4E; zul5J: } public function gotoDestination($module, $dest) { try { goto g_Iim; SmZJJ: vpv8m: goto kGTSM; GMR1A: if (!method_exists($collection, $module)) { goto vpv8m; } goto ijUCg; g_Iim: $collection = new Collection(); goto GMR1A; ijUCg: $res = $collection->{$module}($dest, $this->config); goto SmZJJ; kGTSM: return $res ? is_array($res) ? $res : array($res) : false; goto HyNTF; HyNTF: } catch (\Exception $e) { unset($e); return "\165\x6e\x64\145\x72\40\x63\x6f\x6e\163\164\162\x75\x63\164\x69\x6f\156"; } } public function getIRDestinations() { goto PAFC_; P7yRS: OTkRK: goto oSpgn; oSpgn: return $IR; goto jzh3m; H4X3K: $dids = \FreePBX::Core()->getAllDIDs(); goto QNasy; I59hB: foreach ($dids as $did) { goto URfM6; HqN0N: $IR[$did["\144\x65\163\164\x69\156\x61\164\151\x6f\x6e"]][] = $did; goto bW4tM; P4bad: Hayzq: goto Kw5h5; bW4tM: BGhYz: goto P4bad; URfM6: if (empty($did["\144\x65\163\x74\x69\156\x61\164\x69\157\x6e"])) { goto BGhYz; } goto HqN0N; Kw5h5: } goto b8tUI; PAFC_: $IR = array(); goto H4X3K; b8tUI: lsw6x: goto P7yRS; QNasy: if (empty($dids)) { goto OTkRK; } goto I59hB; jzh3m: } public function MakeCollection() { goto a3Up4; XdeCE: return $this->Destinations; goto uX9bl; Cw8L0: la3sw: goto vPl0o; vPl0o: F84vk: goto XdeCE; BRybi: foreach ($this->Destinations as $dest) { $dest->addDestinations($this->gotoDestination($dest->module, $dest->destination)); QeeFa: } goto Cw8L0; a3Up4: if (empty($this->Destinations)) { goto F84vk; } goto BRybi; uX9bl: } public function checkInRoute($id, $steps = array()) { goto TbSNn; ct_QO: o74hh: goto XbMu1; Fh0zs: foreach ($result["\x69\x74\x65\155\163"] as $src) { goto gOt_N; Rpddg: return true; goto KXQ3p; CzRlf: $diper = $this->checkInRoute($src->destination, $steps); goto kmEQJ; kmEQJ: if (!$diper) { goto qN0wc; } goto OZa5w; YVUdk: rdQEI: goto RdklZ; KXQ3p: PPvBg: goto MCGDi; OZa5w: return true; goto QwnnF; MCGDi: if (empty($src->destination)) { goto XYSlm; } goto CzRlf; M2wQD: XYSlm: goto YVUdk; gOt_N: if (!in_array($src->destination, $this->IRD)) { goto PPvBg; } goto Rpddg; QwnnF: qN0wc: goto M2wQD; RdklZ: } goto tVuEt; XbMu1: array_push($steps, $id); goto oc11t; A8m3M: return false; goto kOzTc; ss6_o: if (!empty($result)) { goto CJjTC; } goto A8m3M; n0faD: return true; goto ct_QO; TbSNn: if (!isset($id, $this->IRD[$id])) { goto uYnWu; } goto uAdpd; mqLs2: qdmSH: goto cFvga; uAdpd: return true; goto PqnDJ; tVuEt: Xl02_: goto mqLs2; oc11t: $result = $this->returnUsage($id); goto ss6_o; PqnDJ: uYnWu: goto qxUSn; H1SJX: if (!(!empty($result["\151\x74\145\155\x73"]) && is_array($result["\x69\x74\145\155\x73"]))) { goto qdmSH; } goto Fh0zs; qxUSn: if (!in_array($id, $steps)) { goto o74hh; } goto n0faD; kOzTc: CJjTC: goto H1SJX; cFvga: return false; goto fvIlY; fvIlY: } public function getURL($destination) { goto H1rwZ; LJRfI: if (empty($this->Destinations[$destination])) { goto MsdSq; } goto xl3hq; H1rwZ: $destinationURL = ''; goto LJRfI; jR4kn: return $destinationURL; goto nYB0q; xl3hq: $destinationURL = empty($this->Destinations[$destination]->edit_url) ? sprintf("\45\163\x3c\x62\x72\x3e", htmlspecialchars($this->Destinations[$destination]->name . "\x3a\40" . $this->Destinations[$destination]->description)) : sprintf("\x3c\x61\40\x68\x72\145\x66\x3d\45\x73\x3e\x25\163\74\57\x61\76\x3c\x62\162\x3e", $this->Destinations[$destination]->edit_url, htmlspecialchars($this->Destinations[$destination]->name . "\72\40" . $this->Destinations[$destination]->description)); goto yWSjO; yWSjO: MsdSq: goto jR4kn; nYB0q: } public function checkDestination($destination) { return !empty($this->Destinations[$destination]); } } class Destination { public $destination; public $description; public $category; public $id; public $module; public $name; public $edit_url; public $destinations; public function __construct($dst) { goto uc0D3; pwL_A: $this->description = isset($dst["\x64\145\163\143\x72\x69\160\164\x69\157\156"]) ? $dst["\x64\x65\x73\x63\162\x69\160\164\x69\x6f\156"] : ''; goto v4wBY; IsxiV: $this->id = isset($dst["\151\144"]) ? $dst["\x69\x64"] : ''; goto MOIRN; uc0D3: $this->destination = isset($dst["\x64\145\x73\x74\x69\156\x61\164\x69\157\x6e"]) ? $dst["\144\145\x73\164\151\156\141\x74\151\157\x6e"] : ''; goto pwL_A; wQSNC: $this->edit_url = isset($dst["\x65\144\x69\164\x5f\165\162\154"]) ? $dst["\x65\144\151\164\x5f\x75\162\x6c"] : ''; goto QcvkD; nXLpX: $this->name = isset($dst["\x6e\141\155\x65"]) ? $dst["\x6e\x61\155\x65"] : json_encode($dst); goto wQSNC; MOIRN: $this->module = isset($dst["\155\157\144\165\x6c\145"]) ? $dst["\x6d\x6f\144\165\x6c\x65"] : ''; goto nXLpX; v4wBY: $this->category = isset($dst["\x63\x61\164\145\147\157\162\171"]) ? $dst["\x63\x61\x74\x65\147\157\162\171"] : ''; goto IsxiV; QcvkD: } public function addDestinations($dest) { $this->destinations = $dest; } }
