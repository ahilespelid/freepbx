<?php
 namespace Informunity\Classes; use Informunity\Log; class SipExtensions { protected $positiveValues = array("\x61\x76\x70\x66" => "\x79\145\x73", "\151\143\145\163\165\160\x70\157\x72\x74" => "\x79\145\x73", "\162\164\143\160\x5f\155\x75\170" => "\171\145\163", "\164\x72\x61\156\163\x70\157\x72\164" => "\x2f\x77\163\163\57"); protected $users = array(); protected $extensions = array(); protected $certificates = array(); public static function load() { return CustomClassName::Load(__CLASS__); } public function get() { goto q2uSI; RB9JH: $this->getCerts(); goto GKsAQ; GKsAQ: return json_encode(encrypt_decrypt("\145\156\143\x72\171\160\x74", json_encode($this->makeResult()))); goto vDzSV; q2uSI: $this->getSip(); goto RB9JH; vDzSV: } protected function getSip() { goto L9Mtk; DgHYY: return array(); goto U6i2c; kKRaS: $stmt = $DB->prepare($sql); goto hWv1l; WikqE: $sip = $stmt->fetchall(\PDO::FETCH_ASSOC); goto YU7km; PsktP: $this->parseSip($sip); goto wo3zg; YU7km: if (!(empty($sip) || !is_array($sip))) { goto orc84; } goto DgHYY; H1xFy: $sql = "\123\x45\114\105\x43\124\40\52\40\x46\122\117\x4d\40\163\151\x70"; goto kKRaS; hWv1l: $stmt->execute(); goto WikqE; U6i2c: orc84: goto PsktP; L9Mtk: $DB = \FreePBX::Database(); goto H1xFy; wo3zg: } protected function parseSip(array $data) { goto hUkhB; hUkhB: $params = array("\141\x76\160\x66", "\x69\143\145\x73\x75\160\160\157\x72\164", "\162\164\143\160\x5f\155\165\170", "\163\145\143\x72\145\x74", "\x74\x72\x61\x6e\x73\160\x6f\162\164", "\163\x69\160\x64\x72\151\x76\145\x72"); goto IBVH4; Egp0_: MwaLN: goto KfnHO; IBVH4: foreach ($data as $extension) { goto B119D; cdwz8: GIVu4: goto Ayl2U; B119D: if (!in_array($extension["\x6b\x65\171\x77\x6f\x72\144"], $params)) { goto GIVu4; } goto FD1Uw; Ayl2U: xkwI3: goto R4RTT; FD1Uw: $this->extensions[$extension["\x69\144"]][$extension["\x6b\145\x79\167\157\x72\144"]] = $extension["\144\141\x74\141"]; goto cdwz8; R4RTT: } goto Egp0_; KfnHO: } protected function getCerts() { goto r33Ok; r33Ok: $certs = \FreePBX::Certman()->getAllDTLSOptions(); goto qoXV0; HAgmD: C8mS6: goto cyLHw; qoXV0: if (!(empty($certs) && !is_array($certs))) { goto C8mS6; } goto IqEbg; IqEbg: return; goto HAgmD; q6PEu: gKJo7: goto GSDnF; cyLHw: foreach ($certs as $certificate) { goto vNP1a; J1gpX: $this->certificates[$certificate["\151\144"]] = true; goto Xu2xv; kboaa: hh2SZ: goto fjAIZ; Z0WIX: goto V50Qf; goto V49i5; V49i5: INK8V: goto J1gpX; fjAIZ: if (!empty($certificate["\166\145\162\151\146\171"])) { goto INK8V; } goto Z0WIX; vNP1a: if (!empty($certificate["\151\144"])) { goto hh2SZ; } goto WO352; WO352: goto V50Qf; goto kboaa; Xu2xv: V50Qf: goto TFa88; TFa88: } goto q6PEu; GSDnF: } protected function makeResult() { goto EHmKO; usCqE: if (!empty($this->extensions)) { goto BNE4l; } goto ad9ps; Co2rC: $driverSuccess = $driver === "\x62\x6f\164\x68" ?: "\143\150\x61\x6e\x5f" . $wsMode === $driver; goto usCqE; EHmKO: $result = array(); goto qfPdn; nk4ML: $wsMode = $amp_conf["\110\124\124\120\127\105\102\x53\x4f\x43\113\105\124\x4d\x4f\x44\105"] === "\x70\x6a\163\x69\x70" ? "\x70\x6a\163\x69\160" : "\163\151\x70"; goto HAAwP; Om1lH: foreach ($this->extensions as $extension => $values) { goto EAyG9; fEP9t: y6hG3: goto bXI29; bXI29: VHFTh: goto d29n4; CeEbS: array_push($result, array("\145\170\x74\145\156\163\151\157\x6e" => $extension, "\144\162\151\x76\145\x72" => $driverSuccess && "\x63\150\141\x6e\137" . $wsMode === $values["\163\x69\x70\144\x72\151\166\145\x72"], "\x61\166\160\x66" => $this->positiveValues["\141\x76\160\x66"] === $values["\141\166\160\x66"], "\x69\x63\x65\x73\x75\160\x70\157\x72\164" => $this->positiveValues["\x69\x63\145\163\165\x70\160\x6f\162\164"] === $values["\x69\x63\x65\163\165\x70\160\x6f\x72\x74"], "\162\164\143\x70\137\155\x75\x78" => $this->positiveValues["\x72\x74\x63\x70\x5f\155\x75\170"] === $values["\x72\164\x63\x70\137\x6d\x75\170"], "\164\x72\141\156\x73\x70\x6f\x72\x74" => preg_match($this->positiveValues["\164\x72\x61\156\163\x70\157\x72\164"], $values["\x74\162\141\156\163\x70\157\162\x74"]) > 0, "\163\145\x63\162\145\164" => $values["\163\x65\143\162\145\164"], "\x73\x69\160\144\x72\151\x76\145\x72" => $values["\163\151\160\144\x72\x69\x76\x65\x72"], "\144\164\154\163" => isset($this->certificates[$extension]) && $this->certificates[$extension])); goto fEP9t; EAyG9: if (empty($values["\163\151\160\144\x72\x69\x76\145\162"])) { goto y6hG3; } goto CeEbS; d29n4: } goto L7r8y; kzMid: return $result; goto VnW7s; HAAwP: $driver = \FreePBX::Config()->get("\101\x53\124\x53\x49\x50\x44\x52\111\126\105\122"); goto Co2rC; qfPdn: global $amp_conf; goto nk4ML; L7r8y: iY4Wq: goto kzMid; PiOwf: BNE4l: goto Om1lH; ad9ps: return $result; goto PiOwf; VnW7s: } }
