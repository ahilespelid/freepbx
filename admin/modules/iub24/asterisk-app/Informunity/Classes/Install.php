<?php
 namespace Informunity\Classes; use FreePBX\modules\Iub24; class Install { protected $Module; private $data = array(); private $updateFields = array("\141\163\163\145\x73\163\155\x65\x6e\164", "\x73\150\157\x77\x5f\143\141\154\154\145\162\137\156\141\x6d\145", "\143\162\145\141\164\x65\137\154\145\x61\x64", "\x73\x68\157\167\x5f\143\x61\162\x64", "\x73\x74\141\x74\x75\163", "\x75\x70\144\x61\164\145\137\154\x65\x61\x64", "\141\144\x64\x5f\x74\157\137\143\150\x61\x74"); public function __construct($Module) { $this->Module = $Module; } public static function Prepare($Module) { return CustomClassName::Prepare(__CLASS__, $Module); } public function pre_newInstall() { return true; } public function post_newInstall() { IUDB::Insert($this->Module["\162\x61\167\x6e\x61\x6d\x65"], array("\x69\144" => 0, "\x65\x78\160\151\162\145\x73" => 0)); $this->setFeatureCodes($this->Module["\162\x61\167\x6e\x61\x6d\x65"]); } public function pre_reInstall() { return true; } public function post_reInstall() { return true; } public function pre_upgrade() { goto u3blh; FLRRu: if (!(!empty($tables) && is_array($tables))) { goto cfOD1; } goto cDtsi; cDtsi: foreach ($tables as $tableName => $tableRows) { goto GPNVK; FnKqs: IUDB::dropTable($tableName); goto emJFE; GPNVK: $this->data["\164\141\142\154\145\163"][$tableName] = $this->prepareTable($tableRows); goto FnKqs; emJFE: i2W_Q: goto g9I9A; g9I9A: } goto b1s33; nQdJI: $tables = IUDB::getModuleTablesData(); goto FLRRu; fQBEj: cfOD1: goto laj1D; u3blh: $this->MysqlDump(); goto nQdJI; b1s33: W3Xr2: goto fQBEj; laj1D: } public function post_upgrade() { IUDB::setModuleTablesData($this->data["\x74\x61\142\x6c\145\x73"]); } public function pre_downgrade() { } public function post_downgrade() { } private function setFeatureCodes($moduleName) { goto bZUBM; PN0Ox: $fcc->update(); goto dFgne; dFgne: unset($fcc); goto TNYu7; xnBsc: $fcc->setDescription("\122\145\x67\x69\x73\x74\145\162\x20\x43\141\154\154\x20\151\156\x20\x42\151\164\162\x69\x78\x32\64"); goto Du440; bZUBM: $fcc = new \featurecode($moduleName, "\x72\x65\x67\x63\x61\x6c\154"); goto xnBsc; Du440: $fcc->setDefault("\43\63"); goto PN0Ox; TNYu7: } private function prepareTable($table) { goto iThY_; dSaei: XOjpZ: goto YKOmS; PSbkb: RjD38: goto dSaei; iThY_: if (!(!empty($table) && is_array($table))) { goto XOjpZ; } goto csuE7; YKOmS: return $table; goto eUKcV; csuE7: foreach ($table as &$tableRow) { goto WvbCJ; byskg: $tableRow["\x6e\165\x6d\142\x65\x72\x73"] = $this->setInteger($tableRow["\x6e\x75\155\142\145\162\x73"]); goto g0Ch9; wModr: $tableRow["\x72\x65\143\157\162\x64\151\156\x67\x73"] = "\x6d\160\63"; goto Abcge; dwm9Z: Ezj5o: goto JwtnC; JwtnC: if (!isset($tableRow["\x61\143\x63\x6f\155\x70\154\151\x63\145\x73"])) { goto Ymly6; } goto b58gg; BaUPw: if (!(isset($tableRow["\x6c\151\x6e\153\163"]) && ($tableRow["\154\151\156\153\x73"] == 1 || $tableRow["\154\x69\156\x6b\163"] == "\171\145\163"))) { goto UsbY7; } goto Tk0OU; WvbCJ: if (!isset($tableRow["\x6e\x75\x6d\x62\x65\x72\163"])) { goto gokus; } goto byskg; D_HUH: if (!(isset($tableRow["\162\x65\143\x6f\162\144\x69\x6e\x67\x73"]) && ($tableRow["\x72\x65\x63\157\x72\x64\151\x6e\x67\x73"] == "\144\x65\146\141\x75\x6c\164" || empty($tableRow["\x72\145\x63\x6f\162\144\x69\156\147\163"])))) { goto SiaZS; } goto wModr; b58gg: $tableRow["\141\x63\x63\157\155\x70\154\151\143\145\x73"] = $this->setInteger($tableRow["\141\143\143\x6f\155\x70\x6c\x69\x63\145\x73"]); goto RQZrh; QERgG: $tableRow["\157\142\x73\x65\x72\166\x65\x72\163"] = $this->setInteger($tableRow["\157\x62\163\145\x72\x76\145\162\x73"]); goto dwm9Z; Abcge: SiaZS: goto BaUPw; fh09Q: if (!isset($tableRow["\157\x62\x73\x65\x72\x76\145\x72\163"])) { goto Ezj5o; } goto QERgG; RQZrh: Ymly6: goto D_HUH; a1f5F: $this->toBoolean($tableRow); goto pyS8O; scBNg: UsbY7: goto a1f5F; apaUH: Mh9YR: goto XA6K5; jpgS_: unset($tableRow["\x6c\151\156\153\163"]); goto scBNg; Tk0OU: $tableRow["\x72\x65\143\x6f\x72\144\151\x6e\147\163"] = "\x6c\151\156\153\x73"; goto jpgS_; g0Ch9: gokus: goto fh09Q; pyS8O: $this->removeCO($tableRow); goto apaUH; XA6K5: } goto PSbkb; eUKcV: } private function setInteger($value) { goto M2yPA; M2yPA: $value = json_decode($value, true); goto PtW5f; P2JD9: return ''; goto ollEG; PtW5f: if (!(json_last_error() === JSON_ERROR_NONE)) { goto Fay51; } goto r0CZW; AXHMg: Fay51: goto P2JD9; t95zi: yCWVe: goto CZZRZ; CZZRZ: return json_encode($value); goto AXHMg; N3faU: foreach ($value as &$elment) { settype($elment, "\x69\156\164\145\x67\145\162"); k6n34: } goto fXtd0; fXtd0: fxYa5: goto t95zi; r0CZW: if (!(!empty($value) && is_array($value))) { goto yCWVe; } goto N3faU; ollEG: } private function removeCO(&$row) { goto hKzph; xpMV0: gYoVd: goto cp6n6; cp6n6: g_sqC: goto WW8VQ; Fp70I: foreach ($row as &$field) { $field = $field === "\x3d\75\40\x63\150\x6f\157\x73\x65\x20\157\156\145\x20\x3d\x3d" ? '' : $field; T0sPK: } goto xpMV0; hKzph: if (!(!empty($row) && is_array($row))) { goto g_sqC; } goto Fp70I; WW8VQ: } private function toBoolean(&$row) { goto Ds56r; jmSld: vjyMU: goto ST_iu; wZmnu: hZABG: goto jmSld; zQcbA: foreach ($this->updateFields as $field) { goto B1KaG; B1KaG: if (!isset($row[$field])) { goto ogFH8; } goto K5Lxk; H6BVx: ogFH8: goto dPxwi; Ndqba: y4XPW: goto P6yn2; P6yn2: uPT3v: goto H6BVx; dPxwi: u6IPv: goto iy8Ur; K5Lxk: switch ($row[$field]) { case "\x6e\x6f": case "\x66\141\x6c\163\145": case false: case "\x64\x69\163\x61\142\x6c\x65\x64": case "\104\x69\163\141\x62\x6c\145\144": $row[$field] = 0; goto uPT3v; case "\x41\x6c\154": case "\171\145\163": case "\x74\162\x75\145": case "\x65\156\x61\x62\154\145\x64": case "\x45\x6e\x61\x62\x6c\145\x64": $row[$field] = 1; goto uPT3v; case "\166\x6f\164\x69\x6e\147": goto CjPul; CjPul: $row["\x61\x73\163\x65\163\163\155\145\156\x74"] = 1; goto CwlWH; CwlWH: $row[$field] = 1; goto fo6Lx; fo6Lx: goto uPT3v; goto rYg7w; rYg7w: case "\x4e\157\101\x6e\163\x77\x65\162\145\144": $row[$field] = 2; goto uPT3v; } goto Ndqba; iy8Ur: } goto wZmnu; Ds56r: if (!(!empty($this->updateFields) && is_array($this->updateFields))) { goto vjyMU; } goto zQcbA; ST_iu: } public function MysqlDump() { goto w3OpO; tZbRO: if (file_exists($filename)) { goto cpP_1; } goto bDSh8; uqEHg: $filename = $amp_conf["\x41\115\x50\x57\105\x42\122\117\117\x54"] . "\57\141\x64\155\x69\x6e\57\155\157\x64\x75\154\145\163\57\x5f\143\x61\143\150\145\x2f\151\165\142\x32\64\137\x74\x61\142\154\x65\x73\137" . $this->Module["\144\142\x76\x65\x72\x73\151\x6f\156"] . "\x5f" . $date->format("\131\137\155\x5f\144") . "\56\163\x71\x6c"; goto tZbRO; k4BJe: cpP_1: goto Qwxhm; eV32v: $date = new \DateTime(); goto uqEHg; bDSh8: exec("\155\x79\x73\161\154\x64\x75\x6d\160\x20\141\x73\x74\x65\162\151\x73\153\40" . implode("\x20", IUDB::getTablesForBackup()) . "\40\76\40" . $filename); goto k4BJe; w3OpO: global $amp_conf; goto eV32v; Qwxhm: } }
