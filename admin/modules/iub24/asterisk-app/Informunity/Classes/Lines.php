<?php
 namespace Informunity\Classes; use Informunity\Log; use Informunity\Rest\App\Lines\Line; use Informunity\UI\Classes\Item; use Informunity\UI\Classes\Panel; class Lines { public static function load() { return CustomClassName::Load(__CLASS__); } private function Get() { goto L1eea; QNV8v: $q = $db->prepare($sql); goto EzgHQ; QMgUn: return $q->fetchAll(\PDO::FETCH_ASSOC); goto dkpzF; L1eea: $db = \FreePBX::Database(); goto A0pKp; A0pKp: $sql = "\x53\105\114\105\x43\124\40\x2a\x20\106\122\117\115\40\151\165\142\x32\x34\137\x6c\x69\156\x65\x73"; goto QNV8v; EzgHQ: $q->execute(); goto QMgUn; dkpzF: } public function getLinesSelectors() { return $this->Get(); } public function getLinesList() { goto xYFju; TyGEu: $lines = $this->Get(); goto s3zNa; Tgz1l: return $status; goto QFlkp; s3zNa: if (!(!empty($lines) && is_array($lines))) { goto fM4BX; } goto TOw_u; TOw_u: foreach ($lines as $line) { $status[$line["\144\x69\x64"]] = $line["\x6e\x75\155\x62\145\x72"]; cD0z3: } goto Hcmmf; Hcmmf: v2MpP: goto sQcGx; sQcGx: fM4BX: goto Tgz1l; xYFju: $status = array(); goto TyGEu; QFlkp: } public function getLines($config) { goto Y3FIJ; HXG1W: $lines = $q->fetchAll(\PDO::FETCH_ASSOC); goto KWs4g; qhGWg: i_UqZ: goto acCvW; KWs4g: $Lines = new Panel(array()); goto gzHzl; Y3FIJ: $db = \FreePBX::Database(); goto moFA1; AxdwV: foreach ($lines as $line) { goto DjHHl; JoIAW: $Lines->addItem($Item); goto B1gOv; m9wiS: R0HRc: goto JoIAW; ROqxH: $used = static::check_linesOnOutbound($line["\x70\162\x65\146\151\x78"], $config["\x70\x68\x72\x61\163\145\163"]); goto C7fTv; xFK08: if (empty($line["\x70\x72\x65\146\151\x78"])) { goto R0HRc; } goto ROqxH; ozM_N: $Item->addProperty(new Item(array("\x6e\141\x6d\145" => "\x75\x73\145\x64", "\x76\x61\154\165\x65" => $used))); goto ZdiFA; ZdiFA: goto MT6Sz; goto zxc1f; C7fTv: if (empty($used)) { goto vhsrk; } goto ozM_N; B_qHW: $Item->addMsg(new Item(array("\164\145\x78\x74" => $config["\x70\x68\162\x61\x73\x65\163"]->getDictionary("\157\x52\157\165\164\x65\163\76\155\x73\147\163\x3e\x70\x72\x65\x66\151\170\x5f\x6e\x6f\164\x5f\165\163\145\x64"), "\164\171\160\145" => "\x77\141\x72\x6e\x69\156\147"))); goto vzvc6; B1gOv: au0C8: goto q4_ln; vzvc6: MT6Sz: goto m9wiS; DjHHl: $Item = new Item(array_merge($line, array("\144\145\154\145\x74\141\142\154\x65" => !($line["\x64\151\144"] === "\104\x65\x66\141\165\154\x74"), "\144\151\163\141\x62\x6c\x65\144" => $line["\x64\151\144"] === "\x44\x65\146\x61\x75\154\164", "\144\x65\163\164\151\156\x61\164\x69\x6f\x6e\125\x52\x4c" => isset($Destinations) ? $Destinations->getURL($line["\144\145\163\x74\151\156\x61\164\151\x6f\x6e"]) : '', "\144\145\163\x74\x69\x6e\x61\164\151\157\x6e" => array("\144\x65\163\164\x69\x6e\x61\164\x69\x6f\x6e" => $line["\x64\145\x73\x74\x69\156\x61\x74\151\x6f\x6e"], "\164\x69\155\x65\157\165\x74" => $line["\x64\x65\x73\164\x69\x6e\141\164\x69\157\156"])))); goto xFK08; zxc1f: vhsrk: goto B_qHW; q4_ln: } goto GUHyx; acCvW: return $Lines; goto RrXDx; EOR59: $Destinations = new Destinations($config); goto AxdwV; Iy8np: $q->execute(); goto HXG1W; GUHyx: R3U60: goto qhGWg; gzHzl: if (!(!empty($lines) && is_array($lines))) { goto i_UqZ; } goto EOR59; moFA1: $q = $db->prepare("\123\x45\114\105\103\x54\x20\x2a\x20\x46\122\x4f\x4d\40\x69\165\x62\x32\64\137\x6c\151\x6e\x65\163\x20\154\x20\114\x45\106\124\40\112\x4f\111\x4e\40\151\165\142\x32\64\137\x63\141\x6c\154\x62\x61\x63\x6b\163\40\x63\x20\117\x4e\x20\x6c\56\x6e\x75\x6d\142\145\162\x3d\143\x2e\154\151\156\145"); goto Iy8np; RrXDx: } private function check_linesOnOutbound($pattern, $phrases) { goto GUDTv; VQzMD: if (empty($res_routes)) { goto DJIxy; } goto EdM29; SOTyK: return implode("\x3c\x62\x72\x3e", $destlist); goto QzaUP; Q6Vdt: $destlist = array(); goto Bbgte; BIUx4: if (!$route_id->execute()) { goto a3skH; } goto NRSMU; AfMTR: a3skH: goto VQzMD; DmUkz: eMMMo: goto AfMTR; NRSMU: $res_route_id = $route_id->fetch(); goto o5P4j; CnSpg: DJIxy: goto SOTyK; SpMp7: $res_routes[] = array("\156\141\155\x65" => $res_route_name["\156\141\155\145"], "\162\157\x75\164\x65\137\151\144" => $res_route_id["\x72\157\165\x74\x65\x5f\x69\x64"]); goto G8kW8; i0vNr: $route_name->bindParam("\x3a\162\157\x75\164\145\137\151\144", $res_route_id["\x72\157\x75\164\x65\x5f\151\144"], \PDO::PARAM_STR); goto J3mty; ZLZb1: qgTUX: goto CnSpg; KC5fZ: $route_name = $db->prepare("\123\x45\x4c\105\x43\x54\x20\156\141\x6d\x65\x20\106\122\x4f\115\x20\x60\x6f\x75\164\142\x6f\165\156\x64\137\162\157\x75\164\145\x73\x60\x20\x57\110\105\122\105\x20\162\x6f\165\164\x65\x5f\x69\x64\x20\75\40\x3a\x72\x6f\x75\x74\x65\137\151\144"); goto i0vNr; EdM29: foreach ($res_routes as $routes) { goto prp7T; prp7T: $id = trim($routes["\162\157\165\164\145\x5f\x69\x64"]); goto r6HM8; wX656: bOSgn: goto gSl44; wMKp6: $destlist[] = "\x3c\x61\40\x68\x72\145\146\x3d\x22\x63\157\156\146\151\x67\x2e\x70\150\160\x3f\x64\x69\163\160\x6c\x61\171\x3d\162\x6f\x75\x74\x69\x6e\x67\46\x76\151\x65\167\75\146\x6f\x72\155\x26\x69\144\75" . $id . "\42\x3e" . sprintf($phrases->getDictionary("\163\171\163\164\145\155\76\117\125\124\102\x4f\125\116\104") . "\72\40\45\163\x20\50\x25\163\x29", $routes["\156\141\x6d\x65"], $id) . "\74\x2f\x61\76"; goto wX656; gSl44: U_8r2: goto VQclg; r6HM8: if (empty($routes["\x6e\141\155\145"])) { goto bOSgn; } goto wMKp6; VQclg: } goto ZLZb1; G8kW8: lGFoH: goto DmUkz; QzaUP: U3K1n: goto Yorb3; o5P4j: if (empty($res_route_id["\162\157\165\x74\145\137\x69\x64"])) { goto eMMMo; } goto KC5fZ; GUDTv: if (empty($pattern)) { goto U3K1n; } goto Tljm8; hgYLC: $res_route_name = $route_name->fetch(); goto SpMp7; Tljm8: $db = \FreePBX::Database(); goto Q6Vdt; Yorb3: return ''; goto Nv1Wh; J3mty: if (!$route_name->execute()) { goto lGFoH; } goto hgYLC; Bbgte: $route_id = $db->prepare("\123\105\114\x45\103\x54\40\x72\x6f\165\164\x65\137\151\144\40\x46\x52\117\x4d\x20\140\157\x75\x74\x62\x6f\x75\156\x64\137\x72\x6f\x75\x74\145\137\160\x61\x74\x74\145\x72\156\163\140\127\x48\x45\122\105\x20\155\141\164\143\x68\x5f\x70\141\164\x74\x65\162\x6e\x5f\x70\x72\x65\x66\x69\x78\40\x4c\x49\x4b\105\x20\47" . $pattern . "\45\47\x20\x4c\x49\115\x49\124\40\61"); goto BIUx4; Nv1Wh: } public function GetOutboundRoutesPrefixesById($id) { goto codWu; elmJV: foreach ($result as $p) { array_push($prefix, $p["\x6d\141\164\x63\150\137\160\x61\x74\x74\145\x72\156\x5f\160\x72\x65\x66\151\x78"]); lFGk3: } goto Dlk6Y; xzwJB: yfYc3: goto bNLDz; GCQ35: if (!(!empty($result) && is_array($result))) { goto tYTbz; } goto elmJV; v2DH1: $patterns_q = $db->prepare("\123\x45\x4c\x45\103\x54\40\x6d\141\x74\143\x68\x5f\x70\x61\164\x74\145\162\x6e\x5f\160\162\145\146\151\x78\40\106\122\117\x4d\x20\x60\157\165\x74\142\157\165\x6e\x64\x5f\162\157\165\164\145\137\x70\x61\x74\164\x65\162\156\163\x60\40\127\x48\105\x52\x45\x20\162\x6f\165\x74\x65\x5f\x69\144\x20\x3d\x20\x3a\x72\157\x75\164\145\x5f\x69\144\40\x41\116\x44\40\x6d\141\164\143\150\x5f\x70\x61\164\x74\x65\162\156\137\x70\x72\145\146\151\x78\x20\74\x3e\40\x27\x27"); goto OlUlD; IvyWc: LoDmL: goto UfvcW; Dlk6Y: vAWDz: goto ByX4f; igJZ1: if (empty($array)) { goto QatJ4; } goto cn3TV; codWu: $db = \FreePBX::Database(); goto v2DH1; bNLDz: whgdu: goto gLwNN; cn3TV: $patterns_l = $db->prepare("\123\x45\114\105\103\x54\x20\156\x75\155\142\145\x72\40\x46\x52\x4f\x4d\x20\140\x69\165\142\62\64\137\x6c\151\x6e\145\163\140\x20\x57\110\105\122\105\x20\x70\162\145\146\151\170\40\x49\x4e\40\x28\47" . $array . "\x27\51\40\x4c\111\x4d\111\124\x20\x31"); goto MoTej; UfvcW: return ''; goto rPshh; AxrGA: $prefix = array(); goto GCQ35; n_JhX: if (!$patterns_q->execute()) { goto LoDmL; } goto pthxg; OT4oe: $line = $patterns_l->fetchAll(\PDO::FETCH_ASSOC); goto fEtRC; OlUlD: $patterns_q->bindParam("\x3a\162\157\x75\164\x65\137\x69\144", $id, \PDO::PARAM_INT); goto n_JhX; pthxg: $result = $patterns_q->fetchAll(\PDO::FETCH_ASSOC); goto AxrGA; ByX4f: tYTbz: goto QvAWy; fEtRC: if (!(!empty($line) && is_array($line))) { goto yfYc3; } goto kvJoY; kvJoY: return $line[0]["\x6e\x75\155\x62\145\162"]; goto xzwJB; QvAWy: $array = implode("\47\54\47", $prefix); goto igJZ1; MoTej: if (!$patterns_l->execute()) { goto whgdu; } goto OT4oe; gLwNN: QatJ4: goto IvyWc; rPshh: } public function SetDefault() { goto s5ikk; EW3nm: $q->execute(); goto h78ak; s5ikk: $db = \FreePBX::Database(); goto YK067; YK067: $q = $db->prepare("\x49\x4e\x53\x45\x52\x54\40\111\x47\x4e\117\122\x45\40\151\165\142\x32\x34\x5f\x6c\151\x6e\145\x73\x20\x28\x64\151\x64\x29\x20\x56\101\x4c\125\105\123\40\50\x27\104\x65\146\x61\165\154\x74\47\x29"); goto EW3nm; h78ak: } public function getPrefixByNumber($number = '') { goto mt0F3; cArN_: $q = $db->prepare($sql); goto xbszr; YGS2m: W3hr1: goto SZpUf; qJyk2: return ''; goto jGvrS; RaQ76: $q->execute(); goto eeOG1; Ew49w: if (!(!empty($result) && is_array($result))) { goto kOhCr; } goto A4Soy; A4Soy: foreach ($result as $value) { goto wFlPt; wFlPt: if (empty($value["\160\162\145\x66\x69\170"])) { goto XTnqL; } goto xUtuq; wBRZj: XTnqL: goto RJTzZ; xUtuq: return $value["\160\x72\x65\146\151\x78"]; goto wBRZj; RJTzZ: TXcbm: goto U1_2t; U1_2t: } goto YGS2m; CEW0J: $sql = "\123\x45\114\105\103\x54\x20\x70\x72\x65\146\151\170\x20\106\x52\117\x4d\x20\x69\x75\142\x32\x34\x5f\x6c\x69\156\x65\163\x20\127\110\x45\122\105\x20\156\165\x6d\x62\145\x72\x20\x3d\x20\x3a\x6e\165\155\142\x65\x72"; goto cArN_; mt0F3: $db = \FreePBX::Database(); goto CEW0J; xbszr: $q->bindParam("\x3a\x6e\x75\155\x62\x65\x72", $number, \PDO::PARAM_STR); goto RaQ76; SZpUf: kOhCr: goto qJyk2; eeOG1: $result = $q->fetchAll(\PDO::FETCH_ASSOC); goto Ew49w; jGvrS: } public function checkLinesByNumber($number) { goto nWd77; S_RZb: pOktQ: goto Fv9Ed; GIYdL: $db = \FreePBX::Database(); goto pDiXN; YgDri: $status = $quresult->result; goto S_RZb; pDiXN: $sql = "\123\105\114\x45\x43\124\40\111\x46\40\50\103\117\x55\116\124\x28\156\165\155\x62\x65\162\51\x3e\x30\54\124\x52\x55\105\40\x2c\x46\101\114\x53\105\x29\x20\162\x65\x73\165\154\x74\40\106\x52\x4f\115\40\151\x75\142\62\64\137\154\151\156\x65\x73\x20\127\x48\105\122\105\40\156\165\x6d\x62\x65\162\40\x3d\x20\x3a\x6e\x75\155\x62\x65\x72"; goto UpX3w; O73hj: $q->execute(); goto y2jz9; UpX3w: $q = $db->prepare($sql); goto Ry1kl; Fv9Ed: return $status; goto qtfJj; HZaxm: if (empty($number)) { goto pOktQ; } goto GIYdL; Ry1kl: $q->bindParam("\72\x6e\165\155\142\x65\x72", $number, \PDO::PARAM_STR); goto O73hj; y2jz9: $quresult = $q->fetch(\PDO::FETCH_OBJ); goto YgDri; nWd77: $status = false; goto HZaxm; qtfJj: } public function updateLine($config, $data) { goto sGL8I; Pxfli: if (isset($params["\151\x64"]) && is_numeric($params["\151\x64"])) { goto GiOJg; } goto dXjK4; cvsLv: if (!isset($params["\x6e\x75\155\x62\145\x72"])) { goto A0u61; } goto nvLRX; sGHX7: Callbacks::load()->deleteCalbackByLine($currentLine); goto lJzon; bZ4IN: S7YoI: goto ECfMd; vJ0Sz: OJjHc: goto sGHX7; nfPbm: if (!isset($params["\x64\x65\x73\x74\x69\x6e\x61\164\151\x6f\156"])) { goto S7YoI; } goto KeKdX; dmKxp: nfYpJ: goto l0Zpi; lJzon: Uu92r: goto gU8HZ; nPP21: Callbacks::load()->updateCallbacks(array("\x64\x65\x73\164\151\156\141\x74\151\x6f\156" => array("\144\145\163\164\x69\x6e\141\164\151\157\x6e" => $CallBackDestination), "\x6c\151\x6e\145" => $params["\x6e\x75\155\x62\x65\x72"])); goto qld0J; yOZuC: needreload(); goto XSTiP; KeKdX: if (empty($params["\x64\145\163\x74\151\x6e\141\x74\x69\157\156"]) || $params["\x64\x65\x73\x74\x69\x6e\x61\x74\151\157\x6e"] == null) { goto OJjHc; } goto WF1qG; eafvy: goto Uu92r; goto vJ0Sz; C5CDy: Line::load($config, array("\156\x75\x6d\142\145\162" => $currentLine, "\141\x63\164\151\x6f\x6e" => "\x64\x65\x6c\145\x74\145"))->Run(); goto s1Jq1; dXjK4: Line::load($config, array("\156\165\x6d\x62\x65\162" => $params["\156\165\155\142\145\162"], "\x61\x63\x74\151\157\x6e" => "\141\144\x64"))->Run(); goto ceMVC; XSTiP: Zh70E: goto q2NsT; q2NsT: return $this->updatePanel(); goto ZBNY6; ceMVC: Callbacks::load()->updateCallbacks(array("\x64\145\163\164\151\156\141\x74\151\x6f\x6e" => $params["\x64\145\163\164\x69\x6e\141\164\x69\x6f\156"], "\154\x69\156\x65" => $params["\156\x75\155\142\145\162"])); goto U5Bdm; pRN4l: $currentLine = $this->getLineById($params["\x69\x64"]); goto cvsLv; WF1qG: Callbacks::load()->updateCallbacks(array("\144\145\163\164\151\x6e\x61\x74\151\x6f\x6e" => $params["\144\x65\163\x74\x69\156\x61\164\151\x6f\x6e"], "\x6c\151\x6e\145" => $currentLine)); goto eafvy; s1Jq1: Line::load($config, array("\x6e\165\x6d\x62\x65\162" => $params["\x6e\165\x6d\142\145\x72"], "\141\143\164\x69\157\x6e" => "\x61\144\144"))->Run(); goto sQpkh; NNXOi: if (!IUDB::Insert("\x69\x75\142\62\x34\x5f\x6c\151\x6e\145\x73", $params)) { goto Zh70E; } goto yOZuC; qld0J: A0u61: goto nfPbm; nvLRX: $CallBackDestination = Callbacks::load()->getCallBackByLineNumber($currentLine); goto C5CDy; WGTvp: GiOJg: goto pRN4l; fj61s: unset($params["\151\x64"], $params["\x64\145\163\164\151\x6e\141\x74\151\157\x6e"]); goto dmKxp; gU8HZ: unset($params["\x64\145\163\164\151\156\141\164\151\x6f\x6e"]); goto bZ4IN; sQpkh: Callbacks::load()->deleteCalbackByLine($currentLine); goto nPP21; sGL8I: $params = $data["\x69\164\x65\x6d\163"]; goto Pxfli; U5Bdm: if (!isset($params["\151\144"])) { goto nfYpJ; } goto fj61s; ECfMd: OXQL_: goto NNXOi; l0Zpi: goto OXQL_; goto WGTvp; ZBNY6: } public function getLineById($id) { goto UUM1C; TQrFa: $q_check = $db->prepare($sql_check); goto VbKQy; zB1Bt: $result = $q_check->fetchAll(\PDO::FETCH_ASSOC); goto Vj9C_; UUM1C: $db = \FreePBX::Database(); goto B1x1N; Vj9C_: return !empty($result) && is_array($result[0]) ? $result[0]["\x6e\x75\x6d\x62\x65\162"] : array(); goto c9ttE; B1x1N: $sql_check = "\x53\105\114\105\103\124\x20\156\165\155\142\x65\162\x20\106\122\117\115\x20\x69\x75\x62\62\x34\137\x6c\x69\x6e\145\163\x20\x57\110\x45\122\105\x20\x69\x64\x3d\x3a\x69\x64"; goto TQrFa; y9DNV: $q_check->execute(); goto zB1Bt; VbKQy: $q_check->bindParam("\x3a\151\144", $id, \PDO::PARAM_STR); goto y9DNV; c9ttE: } public function removeLine($config, $data) { goto gwMcw; J547H: XpSTE: goto Npg78; DrW0B: $q->bindParam("\72\x6c\x69\x6e\145\x69\144", $params["\x69\144"], \PDO::PARAM_STR); goto B2IdA; vzYX_: Line::load($config, array("\x6e\165\155\x62\x65\162" => $params["\x6e\x75\155\x62\145\162"], "\141\x63\x74\x69\x6f\156" => "\x64\145\x6c\x65\164\x65"))->Run(); goto Tvm0u; ewS4a: if (!isset($params["\151\x64"])) { goto XpSTE; } goto YfsZi; W92ub: $sql = "\x44\x45\x4c\x45\124\105\40\x46\x52\x4f\115\40\x69\x75\142\x32\64\137\x6c\x69\x6e\145\x73\x20\x57\110\x45\122\x45\x20\x69\144\x20\75\x20\x3a\154\x69\x6e\145\151\144"; goto oENjD; oENjD: $q = $db->prepare($sql); goto DrW0B; Npg78: if (!($this->countOfNumbers($params) == 0)) { goto OGEAL; } goto vzYX_; dZHGv: return $this->updatePanel(); goto Ym6HO; c_ZxJ: $db = \FreePBX::Database(); goto W92ub; rNrAO: needreload(); goto dZHGv; gwMcw: $params = $data["\x69\164\145\155\x73"]; goto ewS4a; B2IdA: $q->execute(); goto J547H; Tvm0u: OGEAL: goto rNrAO; YfsZi: $params["\x6e\165\155\142\x65\x72"] = $this->getLineById($params["\x69\x64"]); goto c_ZxJ; Ym6HO: } protected function countOfNumbers($data) { goto uWz_q; kQwKA: if (!isset($data["\156\x75\x6d\142\145\x72"])) { goto nFBqr; } goto itmxB; IwJc3: return $result[0]["\143\157\165\x6e\164"]; goto pFgEX; nQnce: nFBqr: goto IwJc3; mKv64: $result = $q->fetchAll(\PDO::FETCH_ASSOC); goto nQnce; i9Bs9: $q->bindParam("\72\x6e\x75\x6d\x62\x65\162", $data["\156\x75\x6d\x62\145\162"], \PDO::PARAM_STR); goto Ep6aU; Ep6aU: $q->execute(); goto mKv64; uWz_q: $result = 0; goto kQwKA; itmxB: $db = \FreePBX::Database(); goto HnapH; HnapH: $sql = "\123\x45\x4c\x45\x43\x54\x20\x43\117\x55\x4e\124\50\156\165\x6d\x62\x65\x72\51\40\x41\x53\x20\x63\157\165\x6e\x74\x20\x46\x52\117\115\x20\x69\165\x62\x32\x34\x5f\x6c\151\x6e\x65\x73\x20\127\x48\x45\122\x45\x20\x6e\x75\x6d\x62\x65\162\75\40\72\x6e\165\x6d\x62\145\162"; goto cgUKN; cgUKN: $q = $db->prepare($sql); goto i9Bs9; pFgEX: } protected function updatePanel() { return array("\155\x65\x73\x73\x61\147\x65" => array("\x61\143\164\x69\x6f\156\x73" => array("\147\x65\164\120\141\x6e\x65\x6c\x49\164\x65\x6d\x73", "\124\x6f\x67\x67\x6c\x65\101\x70\x70\154\171", "\x67\x65\x74\123\145\154\x65\143\164\157\162\163"), "\157\x70\164\x69\157\x6e\163" => array("\x67\x65\164\120\x61\156\145\154\x49\164\145\x6d\163" => "\154\151\x6e\145\163", "\x67\145\x74\123\x65\154\x65\x63\x74\x6f\x72\163" => array("\x6c\151\156\x65\x73")))); } }
