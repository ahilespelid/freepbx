<?php
 namespace Informunity\Rest\App\Users; use Informunity\Interfaces\RestAPI; use Informunity\Log; use Informunity\Rest\Custom; use Informunity\Rest\Methods; use Informunity\Rest\Rest; class GetUsers extends Rest implements RestAPI { protected $arUsers = array(); public static function load($config, $data = array()) { return Custom::GetCustomData($config, $data, __CLASS__); } public function Run() { goto PfOoS; KkF9t: return $this->arUsers; goto YSY97; AIdll: TCXSe: goto usI9P; PfOoS: if (!$this->checkSession()) { goto TCXSe; } goto gwW3F; gwW3F: return $this->arUsers; goto AIdll; usI9P: $this->getUsers(); goto q16hf; q16hf: $this->setToSession(); goto KkF9t; YSY97: } protected function checkSession() { goto FKFZx; EmECC: ukTja: goto uVfbB; qKme4: return true; goto phVA7; uVfbB: $this->arUsers = unserialize($_SESSION["\x69\x75\x62\62\64\137\165\163\x65\162\163"]); goto qKme4; FKFZx: if (!$this->needUpdateUsers()) { goto ukTja; } goto lGtSh; lGtSh: return false; goto EmECC; phVA7: } protected function needUpdateUsers() { goto gFr6a; gFr6a: if (!empty($_SESSION["\151\165\x62\x32\x34\137\x75\x73\145\x72\x73"])) { goto HNn5B; } goto t4eJt; Ku3ci: return true; goto dO3so; bAoEs: if (!($_SESSION["\151\x75\142\x32\x34\137\165\163\145\x72\x73\x5f\141\143\164\165\x61\154"] < time())) { goto hd8cX; } goto Ku3ci; ZCts7: HNn5B: goto bAoEs; dO3so: hd8cX: goto hpxG3; hpxG3: return false; goto coQr7; t4eJt: return true; goto ZCts7; coQr7: } protected function getUsers() { goto DLv9m; RcRF5: return array(); goto HaAMO; DLv9m: $count = $this->GetCountOfUsers(); goto R1eNU; HaAMO: k3QQ9: goto wjL8M; YOeA7: return array(); goto P0sVH; J2evI: $this->processRequests($requests); goto RnFzS; wjL8M: return $this->arUsers; goto UZrk_; RnFzS: if (!empty($this->arUsers)) { goto k3QQ9; } goto RcRF5; cZBhX: $requests = $this->makeRequests($count); goto E1TJw; Eay4t: bH80O: goto cZBhX; P0sVH: uB3Ot: goto J2evI; PeG1J: return array(); goto Eay4t; E1TJw: if (!(empty($requests) || !is_array($requests))) { goto uB3Ot; } goto YOeA7; R1eNU: if (!($count <= 0)) { goto bH80O; } goto PeG1J; UZrk_: } protected function GetCountOfUsers() { $r = $this->query("\x62\141\164\x63\150", array("\150\x61\154\164" => 0, "\143\x6d\x64" => array("\x67\145\164\137\165\163\x65\x72" => Methods::load($this->config)->Get("\165\163\x65\162\x2e\x67\x65\x74") . "\x3f" . http_build_query(array("\101\103\x54\x49\126\105" => "\x59", "\125\123\x45\122\137\x54\x59\120\105" => "\x65\155\x70\x6c\157\171\145\x65"))))); return empty($r["\162\145\163\x75\154\164"]["\162\x65\163\x75\154\164\x5f\164\157\x74\141\x6c"]["\x67\x65\164\x5f\x75\x73\145\x72"]) ? 0 : intval($r["\x72\x65\x73\165\x6c\x74"]["\x72\145\x73\165\154\164\137\164\x6f\x74\141\x6c"]["\147\145\164\x5f\x75\163\145\x72"]); } protected function makeRequests($count) { goto FOuKB; FOuKB: $requests = array(); goto CBdO7; HtFAD: if (!(floor($index / 50) > $numberOfRequest)) { goto vZeAh; } goto Fkf1r; FfbnR: OFHVD: goto i0nBs; NPD_J: eFmgz: goto r9D4B; NT2ST: $numberOfRequest = 0; goto Q0RsK; CBdO7: $numberOfIndexes = ceil($count / 50); goto NT2ST; Fkf1r: $numberOfRequest++; goto OSumi; Q0RsK: $index = 0; goto FfbnR; r9D4B: $index++; goto cthY7; cthY7: goto OFHVD; goto vfv3x; Fy13e: return $requests; goto Rquhz; i0nBs: if (!($index <= $numberOfIndexes - 1)) { goto Dh2jG; } goto HtFAD; OSumi: vZeAh: goto XEJxA; XEJxA: $requests[$numberOfRequest]["\x67\145\164\137\165\x73\145\x72" . $index] = Methods::load($this->config)->Get("\165\163\x65\162\56\x67\145\164") . "\77" . http_build_query(array("\x41\x43\124\111\x56\105" => "\x59", "\125\123\x45\x52\137\124\131\120\x45" => "\x65\x6d\x70\x6c\157\x79\145\145", "\163\164\141\x72\x74" => $index * 50)); goto NPD_J; vfv3x: Dh2jG: goto Fy13e; Rquhz: } protected function processRequests($requests) { foreach ($requests as $request) { goto yj2Ho; oCg1L: s8aab: goto fcoUj; fcoUj: foreach ($res["\162\x65\163\165\154\x74"]["\162\145\163\x75\x6c\x74"] as $group) { goto w2ATa; GWTTO: TqeUj: goto wPbWo; wPbWo: uexz7: goto kACcP; dsAv5: goto uexz7; goto tqOlN; w2ATa: if (!(empty($group) || !is_array($group))) { goto urhqO; } goto dsAv5; tqOlN: urhqO: goto C9i1u; C9i1u: foreach ($group as $user) { goto PO5N_; rmG2H: $this->arUsers[] = $tempUser; goto OC4IU; oER7A: $tempUser["\x4c\101\x53\124\x5f\116\101\115\x45"] = !empty($user["\114\101\123\124\137\116\x41\115\105"]) ? $user["\x4c\101\123\x54\137\x4e\101\115\x45"] : ''; goto ULWtg; y2_nB: if (empty($user["\111\x44"])) { goto NAJMG; } goto McBk1; RozoG: NAJMG: goto cy5OA; dvno2: $tempUser["\x50\105\x52\x53\117\x4e\101\114\x5f\x4d\117\102\x49\114\x45"] = !empty($user["\120\105\122\x53\x4f\x4e\101\114\x5f\115\x4f\x42\x49\x4c\105"]) ? $user["\120\x45\122\123\x4f\116\101\114\137\115\117\x42\111\114\x45"] : ''; goto oER7A; McBk1: $tempUser["\x49\x44"] = $user["\x49\104"]; goto RozoG; PO5N_: $tempUser = array(); goto y2_nB; ULWtg: $tempUser["\116\101\x4d\105"] = !empty($user["\116\x41\x4d\x45"]) ? $user["\x4e\101\x4d\105"] : ''; goto rmG2H; cy5OA: $tempUser["\125\x46\137\120\x48\117\x4e\105\137\111\116\116\105\x52"] = !empty($user["\x55\106\x5f\120\x48\117\116\105\x5f\111\116\116\x45\x52"]) ? $user["\x55\106\137\120\x48\117\116\x45\137\x49\116\x4e\105\122"] : ''; goto dvno2; OC4IU: uBI9y: goto o9DU1; o9DU1: } goto GWTTO; kACcP: } goto jpR02; yj2Ho: $res = $this->query("\x62\141\x74\x63\x68", array("\x68\141\x6c\x74" => 0, "\143\x6d\144" => $request), true); goto dOdHp; dOdHp: if (!(empty($res["\x72\145\163\165\154\164"]["\162\x65\163\165\x6c\x74"]) || !is_array($res["\x72\145\163\165\154\x74"]["\162\x65\x73\x75\x6c\164"]))) { goto s8aab; } goto Hf0yM; Qovxd: SYEla: goto Eh6jq; Hf0yM: goto SYEla; goto oCg1L; jpR02: EWZmD: goto Qovxd; Eh6jq: } YH27z: } protected function setToSession() { $_SESSION["\x69\165\142\62\64\137\x75\163\145\x72\x73"] = serialize($this->arUsers); $_SESSION["\x69\165\142\62\64\x5f\165\163\145\x72\x73\x5f\x61\143\164\165\x61\154"] = time() + 600; } }
