<?php
 namespace Informunity\Rest\App\Call; use Informunity\Classes\CallRecords; use Informunity\Classes\Config; use Informunity\Classes\Dids; use Informunity\Classes\Offline; use Informunity\Classes\OutRoutes; use Informunity\Classes\Region; use Informunity\Classes\Tasks; use Informunity\Interfaces\RestAPI; use Informunity\Log; use Informunity\Rest\App\Recordings; use Informunity\Rest\App\Tasks\CreateTask; use Informunity\Rest\Custom; use Informunity\Rest\Methods; use Informunity\Rest\Rest; class Finish extends Rest implements RestAPI { public $saveData; public $queryData; public $callData = array(); public $queryResult; public $keys = array("\103\x41\x4c\x4c\137\x49\104", "\125\x53\105\x52\x5f\x50\110\117\x4e\105\x5f\x49\116\116\x45\x52", "\123\x54\x41\x54\x55\x53", "\104\125\x52\x41\124\111\x4f\116", "\x4c\x49\116\x4b\105\x44\111\104", "\126\x4f\124\105", "\x52\117\125\x54\105\137\x49\x44", "\x44\111\x52\105\x43\124\111\117\x4e", "\x43\122\115\137\105\116\x54\111\x54\x59\137\x54\x59\x50\105", "\x43\x52\115\x5f\x43\122\x45\101\124\105\x44\137\105\116\124\x49\124\131", "\x43\122\115\x5f\105\116\x54\x49\124\x59\x5f\111\x44", "\114\x49\116\105\x5f\116\x55\x4d\x42\105\122"); public static function load($config, $data = '') { return Custom::GetCustomData($config, $data, __CLASS__); } public function Run() { goto XUYDT; XUYDT: $this->BeforeQuery(); goto ooyxU; tCZ27: return $this->AfterQuery(); goto r50W6; ooyxU: $this->queryResult = $this->query("\164\145\154\145\160\x68\157\x6e\171\x2e\145\170\164\145\x72\156\141\154\x63\x61\154\x6c\x2e\146\x69\156\x69\163\x68", $this->queryData); goto tCZ27; r50W6: } protected function BeforeQuery() { goto GhA5L; tfXgn: $this->queryData["\x41\104\104\x5f\124\117\137\x43\110\101\124"] = $this->ADD_TO_CHAT(); goto pGtlq; GhA5L: $this->saveData = $this->data[2]; goto gt_TP; ixHf8: $this->setRouteData(); goto cZWLg; ZdcaG: $this->bq_getUserID(); goto ixHf8; cZWLg: $this->queryData["\123\124\x41\124\x55\x53\x5f\103\117\104\x45"] = $this->setSatusCode(); goto tfXgn; pGtlq: $this->setEntityData(); goto H9JEU; H9JEU: $this->setUserId(); goto Bfj1f; gt_TP: $this->queryData = CheckData::load($this->keys, $this->saveData, $this->config["\154\x6f\x67\x67\151\156\147"])->Run(); goto ZdcaG; Bfj1f: } protected function AfterQuery() { goto qX1oB; MkywA: BCsDC: goto ZpZOU; RJDWl: $this->queryData["\103\122\115\x5f\101\x43\124\x49\x56\x49\124\x59\137\x49\x44"] = $this->queryResult["\x72\x65\x73\x75\154\164"]["\x43\122\115\137\101\103\124\111\x56\111\x54\131\x5f\x49\x44"]; goto L9yNy; EXCNr: CallRecords::deleteRecords($this->queryData["\x4c\111\x4e\x4b\x45\x44\x49\104"]); goto vY50D; ZpZOU: if (!($this->queryData["\123\124\x41\124\x55\123\x5f\x43\117\104\x45"] != "\62\x30\x30" && !empty($this->callData["\x54\x41\123\113\137\x54\105\115\x50\x4c\101\x54\105"]))) { goto E8iKE; } goto hACpv; q5tPG: return true; goto qkQA3; J8tIF: $filesToDelete = array_merge($AddRecordsResult["\x64\145\x6c\145\x74\x65"], empty($resendResult["\144\145\x6c\145\x74\x65"]) ? array() : $resendResult["\x64\145\x6c\x65\164\145"]); goto lZsJ9; QlJJa: $this->queryData["\x43\122\115\x5f\105\116\x54\111\x54\x59\x5f\x49\104"] = empty($this->queryData["\103\x52\x4d\137\105\116\x54\x49\124\x59\137\111\x44"]) && !empty($this->queryResult["\162\x65\163\165\x6c\x74"]["\103\122\x4d\137\105\x4e\x54\111\x54\x59\137\111\x44"]) ? $this->queryResult["\162\x65\x73\165\154\x74"]["\x43\122\115\137\x45\116\124\111\x54\131\137\x49\x44"] : $this->queryData["\103\x52\115\137\105\x4e\x54\111\x54\x59\137\x49\104"]; goto lIA1z; VHiBV: $this->queryData["\125\123\105\x52\x5f\x49\x44"] = empty($this->queryData["\125\123\105\x52\x5f\111\x44"]) && isset($this->callData["\x52\x4f\125\124\x45\137\144\141\164\x61"]["\x75\x73\145\x72\x5f\151\x64"]) ? $this->callData["\x52\x4f\x55\124\x45\x5f\x64\141\x74\x61"]["\x75\x73\145\162\x5f\151\x64"] : $this->queryData["\125\x53\105\122\x5f\111\x44"]; goto ffb0U; t3i4I: sleep(5); goto RJDWl; G0gBt: $this->queryData["\103\x52\115\137\105\116\124\x49\124\131\137\124\x59\x50\105"] = empty($this->queryData["\103\x52\115\137\105\x4e\124\x49\124\x59\x5f\x54\x59\x50\x45"]) && !empty($this->queryResult["\162\145\163\165\154\x74"]["\103\x52\115\x5f\x45\116\124\111\124\131\x5f\x54\131\x50\x45"]) ? $this->queryResult["\162\145\x73\165\154\x74"]["\x43\x52\115\x5f\105\x4e\x54\x49\x54\x59\137\124\x59\x50\105"] : $this->queryData["\103\122\115\137\105\x4e\124\x49\124\131\137\124\131\x50\105"]; goto QlJJa; L9yNy: $AddRecordsResult = Recordings\AddRecords::load($this->config, array_merge($this->callData, $this->queryData, array("\122\x45\x43\x4f\122\x44\x53" => $records)))->Run(); goto MkywA; QcsSs: $this->callData["\x47\x45\x54\x5f\105\116\124\111\x54\131\x5f\x44\x41\x54\x41"] = $result; goto zJl4T; qX1oB: if ($this->queryResult) { goto mBysL; } goto NiRZK; NiRZK: Offline::SaveRequest("\x66\151\x6e\x69\x73\x68", $this->saveData, $this->queryData["\x43\x41\114\114\137\x49\104"]); goto dwQch; iDPHO: ByDjm: goto Fd2jG; c2m4f: f2ZVa: goto VzhmM; NTzps: Region::load(array())->addRegionInLeadBx24($this->config, $this->queryResult["\x72\x65\x73\x75\x6c\x74"]["\x43\x52\x4d\x5f\x45\116\124\111\124\x59\x5f\x49\x44"], substr($this->queryResult["\162\145\163\x75\x6c\164"]["\120\110\117\x4e\x45\x5f\116\x55\x4d\102\105\122"], -10)); goto iDPHO; RkiSO: $this->queryData["\x55\x53\x45\x52\x5f\111\104"] = $result["\162\145\x73\165\154\x74"]["\162\x65\x73\x75\154\164"]["\147\145\164\x5f\x75\163\145\x72"][0]["\x49\104"]; goto VHiBV; gZ_bK: if (!(!isset($this->queryResult["\145\x72\162\x6f\162"]) && !empty($records))) { goto BCsDC; } goto t3i4I; Fd2jG: $resendResult = Recordings\ResendRecords::load($this->config, array())->Run(); goto J8tIF; VzhmM: $this->CreateTask(array_merge($this->callData, $this->queryData)); goto yYCf1; lIA1z: $this->queryData["\120\110\117\x4e\105\137\x4e\125\x4d\102\105\x52"] = empty($this->queryResult["\162\145\x73\165\154\x74"]["\120\x48\x4f\116\x45\137\x4e\x55\115\102\105\122"]) ? '' : $this->queryResult["\162\145\163\x75\154\164"]["\x50\x48\117\x4e\105\137\x4e\125\x4d\102\x45\122"]; goto Hwe1J; ffb0U: MuNM6: goto c2m4f; Hwe1J: $records = CallRecords::getRecords($this->queryData["\114\x49\x4e\x4b\x45\104\x49\104"]); goto EXCNr; vY50D: $AddRecordsResult = array("\144\145\x6c\x65\x74\x65" => array()); goto gZ_bK; lZsJ9: $this->removeTempRecords($filesToDelete); goto q5tPG; hACpv: if (!empty($this->queryResult)) { goto f2ZVa; } goto zW0Uu; CRXwc: if (!(!isset($this->queryResult["\x65\x72\162\157\162"]) && $this->config["\144\145\164\x5f\162\145\147\151\157\x6e"] == "\x31" && $this->queryResult["\x72\x65\163\165\x6c\x74"]["\103\122\x4d\137\x45\x4e\x54\x49\124\131\137\124\x59\120\105"] == "\114\105\x41\104")) { goto ByDjm; } goto NTzps; dwQch: return false; goto I9t7S; yYCf1: E8iKE: goto CRXwc; zW0Uu: $result = $this->GetEntityData($this->queryData); goto QcsSs; I9t7S: mBysL: goto G0gBt; zJl4T: if (!(isset($this->callData["\x52\117\x55\124\x45\137\x64\141\x74\141"]["\x61\163\163\x69\x67\x6e"]) && $this->callData["\122\117\125\x54\105\x5f\x64\x61\164\x61"]["\x61\163\x73\151\147\x6e"] == "\155\141\x6e\141\x67\x65\x72" || empty($this->queryData["\x55\x53\105\x52\137\x49\x44"]))) { goto MuNM6; } goto RkiSO; qkQA3: } protected function removeTempRecords($delete) { goto aRUBF; K2ELM: jk7oQ: goto FPeTc; FPeTc: gHuW8: goto vF7cY; T3BNi: foreach ($delete as $file_to_del) { goto D3fKq; aorM7: TiYRt: goto zGLXb; D3fKq: if (!file_exists($file_to_del)) { goto TiYRt; } goto D3Jdy; zGLXb: FMSOO: goto Oll_4; D3Jdy: unlink($file_to_del); goto aorM7; Oll_4: } goto K2ELM; aRUBF: if (empty($delete)) { goto gHuW8; } goto T3BNi; vF7cY: } protected function CreateTask($data) { CreateTask::load($this->config, $data)->Run(); } protected function setRouteData() { goto OkiJf; Cfu18: AabE_: goto bV5AZ; ssAKQ: $this->callData["\x52\117\x55\124\x45\x5f\x64\x61\164\141"] = Dids::load()->getDidByIDApp(array("\x69\144" => $this->queryData["\122\x4f\125\x54\x45\x5f\111\x44"])); goto vBxTf; vBxTf: if (!(!empty($this->callData["\122\117\125\124\x45\x5f\x64\x61\x74\141"]["\x74\x61\163\x6b"]) && $this->callData["\x52\x4f\x55\x54\105\x5f\x64\x61\164\x61"]["\x74\141\163\153"] != 0)) { goto oGwQ3; } goto V2CT4; Wdojh: zjqbC: goto GfQul; V2CT4: $this->callData["\124\x41\x53\113\x5f\124\105\115\120\x4c\x41\x54\105"] = Tasks::load()->getTaskByID($this->callData["\x52\x4f\125\124\x45\137\144\x61\164\x61"]["\164\141\163\153"]); goto nzbQ5; MKbp7: MRF5Q: goto ssAKQ; nzbQ5: oGwQ3: goto Wdojh; bV5AZ: if ($this->queryData["\104\111\x52\x45\103\x54\x49\x4f\116"] === "\x49\x4e\102\x4f\x55\116\x44") { goto MRF5Q; } goto pxPCZ; OkiJf: if (!empty($this->queryData["\122\x4f\125\x54\105\x5f\x49\x44"])) { goto AabE_; } goto FBnIs; FBnIs: return; goto Cfu18; pxPCZ: $this->callData["\x52\x4f\125\124\105\x5f\x64\141\x74\141"] = OutRoutes::load()->getRouteOutboundByID($this->queryData["\122\x4f\125\x54\x45\x5f\111\104"]); goto v8_gE; v8_gE: goto zjqbC; goto MKbp7; GfQul: } protected function setSatusCode() { goto TObcN; dCLy4: return isset($STATUS[$this->queryData["\123\x54\101\124\x55\123"]]) ? $STATUS[$this->queryData["\123\124\101\124\x55\123"]][$DIRECTION] : $this->queryData["\123\x54\x41\x54\x55\123"]; goto v7Vwq; I9aea: $DIRECTION = (int) (!empty($this->queryData["\x44\111\x52\x45\103\x54\111\117\116"])); goto dCLy4; TObcN: $STATUS = Config::LoadStatusArray($this->config); goto I9aea; v7Vwq: } protected function ADD_TO_CHAT() { goto WZV21; B5wy3: if (!($this->callData["\122\x4f\x55\x54\x45\137\x64\x61\164\141"]["\141\x64\144\137\x74\157\x5f\143\150\141\x74"] == 2 && $this->queryData["\x53\x54\x41\124\125\123\x5f\x43\117\104\105"] != 200)) { goto yDSxq; } goto bD3Ld; AWfwO: if (!($this->callData["\122\117\x55\x54\105\x5f\144\141\x74\141"]["\141\x64\x64\137\164\x6f\137\143\150\141\164"] == 1)) { goto SpT7B; } goto cqLw6; cqLw6: return 1; goto djmJm; mhloF: yDSxq: goto SdVY3; bD3Ld: return 1; goto mhloF; djmJm: SpT7B: goto B5wy3; SdVY3: return 0; goto xYBX5; RiVmi: return 0; goto OLePA; WZV21: if (!empty($this->callData["\122\117\125\x54\x45\137\144\x61\164\141"])) { goto iwSfc; } goto RiVmi; OLePA: iwSfc: goto AWfwO; xYBX5: } protected function setEntityData() { goto Vl9PH; DLw2k: $this->queryData["\x55\x53\x45\122\137\111\104"] = $results["\162\x65\x73\165\154\164"]["\x72\145\x73\165\154\x74"]["\x67\x65\x74\x5f\165\x73\x65\x72"][0]["\111\x44"]; goto dqG_N; bFhN7: EHfON: goto AegZA; zBThZ: return; goto pd5k5; d7qpi: $results = $this->GetEntityData($this->queryData); goto dpjAL; v9ThQ: $this->callData["\x47\105\x54\x5f\x45\116\124\111\124\131\137\104\101\124\x41"] = $results; goto E0KJB; E0KJB: $this->queryData["\125\123\105\122\137\x49\x44"] = $results["\x72\145\163\x75\x6c\x74"]["\x72\x65\x73\165\x6c\164"]["\147\145\164\x5f\165\163\x65\162"][0]["\111\104"]; goto bFhN7; pd5k5: eqAtQ: goto AfSZm; AegZA: if (!($this->callData["\x52\x4f\x55\x54\105\x5f\x64\x61\x74\141"]["\x61\x73\163\x69\x67\x6e"] == "\154\141\x73\x74" && empty($this->queryData["\125\123\x45\x52\x5f\120\x48\117\116\105\137\111\116\x4e\105\x52"]) && empty($this->queryData["\103\122\x4d\137\103\122\x45\101\124\105\104\137\x45\x4e\124\111\x54\x59"]) && !empty($this->queryData["\103\x52\x4d\137\x45\x4e\124\111\x54\x59\x5f\124\x59\x50\x45"]))) { goto UvGOK; } goto d7qpi; EK4qS: YW0Nk: goto GAkQD; dpjAL: $this->callData["\107\105\x54\137\105\116\x54\x49\x54\131\137\x44\x41\124\101"] = $results; goto DLw2k; pycY0: if (isset($this->callData["\x52\x4f\125\x54\105\x5f\144\141\x74\x61"]["\x61\x73\x73\151\x67\x6e"])) { goto YW0Nk; } goto Bi11o; GAkQD: if (!($this->callData["\x52\117\125\x54\x45\x5f\x64\x61\164\141"]["\x61\x73\x73\151\x67\x6e"] == "\x6d\141\156\141\x67\145\x72" && empty($this->queryData["\x43\x52\x4d\137\x43\x52\x45\101\124\105\104\x5f\105\x4e\x54\x49\x54\x59"]) && !empty($this->queryData["\103\x52\x4d\137\x45\x4e\124\x49\x54\x59\137\124\x59\120\105"]))) { goto EHfON; } goto bFV2R; h48Uo: return; goto fm9Hc; dqG_N: UvGOK: goto jC3lL; Vl9PH: if (!($this->queryData["\x53\x54\x41\x54\x55\123\137\x43\x4f\x44\x45"] == 200)) { goto eqAtQ; } goto zBThZ; fm9Hc: SCiT_: goto pycY0; bFV2R: $results = $this->GetEntityData($this->queryData); goto v9ThQ; AfSZm: if ($this->callData["\122\117\125\124\x45\x5f\144\141\x74\x61"]) { goto SCiT_; } goto h48Uo; Bi11o: return; goto EK4qS; jC3lL: } protected function setUserId() { goto QT2rI; QT2rI: if (!empty($this->queryData["\125\123\105\122\x5f\x49\104"])) { goto aWGf4; } goto zlUle; zlUle: if (!isset($this->callData["\x52\117\125\x54\105\137\x64\141\x74\141"]["\x61\163\x73\151\x67\x6e"])) { goto mnLvL; } goto ST41K; G1Je9: s0V4v: goto tp5Pz; l3cj9: $this->queryData["\x55\x53\x45\x52\x5f\111\104"] = array_pop($userArray); goto G1Je9; SA7uH: aWGf4: goto p9uYC; mDrwq: goto s0V4v; goto SA7uH; tp5Pz: unset($this->queryData["\125\x53\105\x52\x5f\120\110\117\x4e\x45\x5f\x49\x4e\x4e\105\x52"]); goto QLucn; ST41K: $this->queryData["\125\123\x45\x52\x5f\x49\104"] = $this->callData["\x52\117\125\x54\105\x5f\144\x61\164\141"]["\165\163\x65\162\137\x69\x64"]; goto OWke8; p9uYC: $userArray = explode("\174", $this->queryData["\x55\123\x45\x52\x5f\111\x44"]); goto l3cj9; OWke8: mnLvL: goto mDrwq; QLucn: } protected function GetEntityData($data) { goto GAb6o; h0Z2U: return $this->query("\x62\x61\164\143\x68", array("\x68\x61\154\164" => 0, "\x63\x6d\x64" => array("\147\x65\x74\x5f\x65\156\164\x69\x74\x79" => Methods::load($this->config)->Get("\x63\x72\155\x2e" . $entityType . "\56\147\x65\164") . "\x3f" . http_build_query(array("\111\104" => $data["\103\122\x4d\137\x45\x4e\124\x49\x54\131\137\x49\104"])), "\x67\x65\x74\137\x75\x73\145\162" => Methods::load($this->config)->Get("\165\163\145\x72\56\x67\145\x74") . "\x3f" . http_build_query(array("\111\x44" => "\x24\162\145\x73\x75\x6c\164\x5b\x67\145\x74\x5f\x65\x6e\x74\x69\x74\x79\x5d\x5b\x41\123\123\x49\x47\116\105\104\x5f\102\x59\137\x49\104\x5d", "\x41\103\x54\111\x56\x45" => "\x59"))))); goto zVZKp; GAb6o: $entityType = strtolower($data["\103\x52\115\x5f\x45\x4e\x54\111\x54\x59\137\x54\131\x50\105"]); goto uk0ZH; uk0ZH: $this->setStartQuery(); goto h0Z2U; zVZKp: } protected function bq_getUserID() { goto cCbRY; cWYRF: auoQD: goto JpfWu; jJGhU: if (!(!empty($req[0]) && !empty($req[0][0]) && !empty($req[0][0]["\x49\x44"]))) { goto GzOV9; } goto vldzf; JRUO_: if (empty($this->queryData["\125\123\x45\122\137\x49\104"])) { goto auoQD; } goto CowDM; fpjbN: $req = GetUserID::load($this->config, array(2 => $this->queryData["\x55\123\105\x52\137\120\x48\x4f\x4e\x45\x5f\x49\x4e\116\x45\122"]))->Run(); goto jJGhU; cCbRY: global $astman; goto JRUO_; JpfWu: $this->queryData["\125\123\x45\x52\137\x49\x44"] = $astman->database_get("\111\125\102\x32\x34", $this->queryData["\x55\123\105\122\x5f\x50\110\x4f\x4e\x45\x5f\111\116\x4e\x45\122"] . "\x2f\111\x44"); goto B_s1r; B_s1r: if (!(empty($this->queryData["\125\123\105\x52\137\x49\x44"]) && !empty($this->queryData["\125\x53\105\122\x5f\x50\x48\117\116\x45\x5f\x49\116\116\105\122"]))) { goto svpHs; } goto fpjbN; KuWQ5: GzOV9: goto DE8rc; DE8rc: svpHs: goto BUsfV; CowDM: return; goto cWYRF; vldzf: $this->queryData["\125\123\105\122\x5f\x49\x44"] = $req[0][0]["\111\104"]; goto KuWQ5; BUsfV: } }
