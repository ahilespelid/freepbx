<?php
 namespace Informunity\Rest\App\Tasks; use Informunity\Interfaces\RestAPI; use Informunity\Log; use Informunity\Rest\App\Recordings\ConvertRecords; use Informunity\Rest\Custom; use Informunity\Rest\Rest; class CreateTask extends Rest implements RestAPI { protected $date; public static function load($config, $data = array()) { return Custom::GetCustomData($config, $data, __CLASS__); } public function Run() { goto Dcj4j; O_drI: $this->setStartQuery(); goto SgTIP; nPhqX: GViiL: goto zlcDG; leoEL: if (empty($files)) { goto BLO6_; } goto xp9bq; TsW9L: $taskID = $r["\x72\145\163\165\x6c\x74"]; goto DdT0Y; xp9bq: foreach ($files as $file) { goto t5OdJ; cDXVG: unlink($conv["\144\145\154\x65\164\145"]); goto iYEQr; iYEQr: f82n7: goto bDly0; RQ5dL: $this->setStartQuery(); goto qAqMh; bDly0: kswVW: goto w2uac; t5OdJ: if (empty($file)) { goto kswVW; } goto HtNtL; qAqMh: $this->query("\164\x61\163\153\x2e\x69\164\145\x6d\x2e\x61\x64\144\x66\151\x6c\x65", array("\x54\x41\x53\x4b\x5f\111\x44" => $taskID, "\106\111\x4c\x45" => array("\x4e\x41\x4d\x45" => basename($conv["\x66\x69\x6c\x65"]), "\x43\x4f\x4e\124\105\x4e\124" => base64_encode(file_get_contents($conv["\x66\x69\154\x65"]))))); goto cDXVG; HtNtL: $conv = ConvertRecords::load($this->config, array("\146\151\x6c\145" => $file))->Run(); goto E2kst; E2kst: if (isset($conv["\145\x72\x72\157\162"])) { goto f82n7; } goto RQ5dL; w2uac: VH6Gh: goto NGMM5; NGMM5: } goto nPhqX; cKOtn: return $taskID; goto MKTo4; sKVvC: Gpwgr: goto TsW9L; SgTIP: if (empty($Task)) { goto N2SgM; } goto lELCu; zlcDG: BLO6_: goto XJ13d; VIFzb: N2SgM: goto HTMKr; CzmcV: $this->date = new \DateTime(); goto Gl5ic; YX_mm: $title = $this->getTitle(); goto CzmcV; Dcj4j: $taskID = ''; goto YX_mm; rWMPE: $files = explode("\174", $this->data["\x52\x45\x43\x4f\x52\104\x53"]); goto leoEL; XJ13d: MKm4I: goto cKOtn; lELCu: $r = $this->query("\164\141\x73\153\56\151\164\x65\x6d\56\165\160\x64\x61\164\x65", array("\x49\104" => $Task["\111\x44"], "\x54\101\x53\113\104\x41\124\x41" => array("\x54\111\124\x4c\x45" => $Task["\x54\111\124\x4c\x45"], "\x44\x45\x53\x43\x52\111\x50\x54\x49\x4f\x4e" => $this->getDescription($Task["\x44\105\123\x43\122\x49\x50\x54\111\117\116"])))); goto ZNtSp; Gl5ic: $crmTask = $this->getCRMEnt(); goto kQ0RE; ilph0: goto Gpwgr; goto VIFzb; HTMKr: $r = $this->query("\x74\x61\163\153\56\x69\164\x65\155\x2e\x61\x64\144", array("\x54\x41\x53\113\x44\x41\124\101" => array("\x54\111\124\x4c\x45" => $title, "\104\105\123\103\x52\x49\x50\x54\x49\x4f\x4e" => $this->getDescription(), "\104\105\101\x44\x4c\111\116\x45" => $this->getDeadline(), "\x43\122\105\x41\x54\105\104\137\x42\x59" => intval($this->data["\125\x53\105\x52\137\111\x44"]), "\122\105\x53\x50\117\x4e\x53\111\x42\114\105\x5f\111\x44" => intval($this->data["\125\x53\x45\x52\137\111\x44"]), "\x41\x55\104\x49\x54\x4f\x52\123" => json_decode($this->data["\x54\x41\123\x4b\x5f\x54\x45\115\x50\x4c\101\124\x45"]["\157\x62\x73\x65\x72\166\145\x72\x73"]), "\x41\x43\103\117\115\120\x4c\x49\103\x45\123" => json_decode($this->data["\x54\x41\x53\113\137\124\x45\x4d\120\x4c\101\x54\105"]["\141\x63\x63\157\x6d\160\x6c\x69\x63\x65\163"]), "\125\x46\137\x43\x52\115\x5f\124\x41\x53\113" => array($crmTask)))); goto sKVvC; DdT0Y: if (!($taskID && !empty($this->data["\x52\105\103\117\x52\104\123"]))) { goto MKm4I; } goto rWMPE; R4hnA: BW2ak: goto ilph0; kQ0RE: $Task = empty($crmTask) ? array() : $this->getExistingTask($title, $crmTask); goto O_drI; ZNtSp: if (!empty($r["\x65\162\x72\x6f\162"])) { goto BW2ak; } goto oM1ka; oM1ka: $r["\162\x65\x73\x75\x6c\x74"] = $Task["\x49\x44"]; goto R4hnA; MKTo4: } protected function getDeadline() { goto A2nzb; A2nzb: $deadline = $this->date->getTimestamp(); goto q0P4g; GAj_o: return date(DATE_ISO8601, $deadline); goto xIwPT; IQOAm: bjySf: goto yYHrr; yYHrr: bOXb1: goto GAj_o; q0P4g: switch ($this->data["\x54\x41\x53\113\137\x54\105\x4d\x50\x4c\101\x54\105"]["\144\145\x61\x64\x6c\151\x6e\145\x5f\x64\141\171"]) { case "\x4d\x69\156\165\164\x65\x73": $deadline = $deadline + $this->data["\124\101\x53\x4b\x5f\x54\x45\x4d\120\x4c\x41\x54\105"]["\x64\145\141\x64\x6c\x69\x6e\145"] * 60; goto bOXb1; case "\110\157\165\162\163": $deadline = $deadline + $this->data["\x54\x41\x53\113\x5f\x54\105\115\120\x4c\x41\x54\105"]["\144\x65\x61\x64\154\x69\156\x65"] * 3600; goto bOXb1; case "\x44\x61\171\x73": $deadline = $deadline + $this->data["\x54\x41\x53\113\x5f\124\105\115\x50\x4c\x41\x54\x45"]["\144\x65\x61\144\x6c\x69\156\145"] * 24 * 3600; goto bOXb1; } goto IQOAm; xIwPT: } protected function getExistingTask($title, $crmTask) { goto YO2Bk; JfqYP: $this->setStartQuery(); goto Zhdma; Px9Ne: foreach ($rsTask["\x72\x65\x73\x75\x6c\164"] as $Task) { goto BnbpQ; BnbpQ: if (!(in_array($crmTask, $Task["\125\x46\x5f\103\x52\115\x5f\x54\101\123\x4b"]) && !empty($Task))) { goto oKfhl; } goto BsuNA; WOQyC: oKfhl: goto cw0Jq; BsuNA: $arTasks[] = $Task; goto WOQyC; cw0Jq: aBY6D: goto oI6Mq; oI6Mq: } goto VhE2u; YO2Bk: $arTasks = array(); goto JfqYP; z2UBG: if (!(!empty($rsTask) && is_array($rsTask))) { goto VhSMh; } goto Px9Ne; Twh1J: VhSMh: goto S45pa; VhE2u: qQrZM: goto Twh1J; Zhdma: $rsTask = $this->query("\x74\x61\x73\153\x2e\151\164\145\x6d\56\x6c\x69\x73\x74", array("\117\x52\104\x45\x52" => array("\x44\x41\x54\x45\x5f\123\x54\x41\x52\x54" => "\x44\105\123\x43"), "\106\111\114\124\x45\x52" => array("\124\x49\x54\x4c\x45" => trim($title), "\103\x52\105\x41\124\x45\x44\x5f\102\131" => intval($this->data["\125\123\105\122\x5f\111\104"]), "\x52\105\123\120\x4f\116\x53\x49\x42\x4c\x45\x5f\111\x44" => intval($this->data["\x55\123\105\122\137\x49\104"]), "\74\x53\124\101\x54\x55\x53" => 4), "\120\101\122\x41\x4d\x53" => array("\x4e\101\126\137\x50\x41\x52\101\115\x53" => array("\x6e\x50\x61\x67\x65\123\151\172\145" => 10, "\x69\116\x75\x6d\120\141\x67\x65" => 2)), "\x73\x65\x6c\x65\x63\x74" => array("\x49\104", "\x54\x49\x54\114\x45", "\x44\105\x53\x43\122\111\120\x54\111\x4f\116", "\125\x46\x5f\x43\x52\115\137\124\x41\123\113"))); goto z2UBG; S45pa: return empty($arTasks[0]) ? array() : $arTasks[0]; goto C3lHh; C3lHh: } protected function getTitle() { goto W4KX2; TX4Eq: return $this->data["\x54\x41\x53\113\137\124\x45\x4d\120\114\101\124\105"]["\156\x61\155\x65"] . "\x3a\x20" . $this->data["\x50\110\x4f\x4e\x45\x5f\x4e\125\x4d\102\x45\122"]; goto Xyt1l; NZIB9: xz7O_: goto xrmeq; zvhgD: return $this->data["\x54\101\123\113\x5f\124\x45\115\x50\x4c\x41\x54\105"]["\156\141\155\x65"] . "\x3a\40" . $this->data["\x47\105\x54\x5f\105\116\124\111\x54\131\137\x44\x41\124\101"]["\x72\145\x73\x75\x6c\x74"]["\x72\145\x73\165\154\x74"]["\x67\x65\x74\x5f\x65\x6e\164\x69\164\171"]["\x54\111\x54\x4c\105"]; goto d5_6E; QAijj: Yv3Xp: goto zvhgD; y4KSq: bXk5c: goto F49xh; W4KX2: if (!empty($this->data["\107\105\124\137\105\116\124\x49\x54\131\x5f\104\101\x54\101"])) { goto xz7O_; } goto TX4Eq; Xyt1l: goto bXk5c; goto NZIB9; tMw3B: return $this->data["\x54\101\x53\113\137\124\105\115\x50\x4c\101\124\x45"]["\156\141\x6d\x65"] . "\72\x20" . $this->data["\x47\105\124\137\x45\x4e\124\x49\x54\x59\137\x44\101\x54\x41"]["\162\x65\163\165\x6c\164"]["\x72\x65\163\x75\154\x74"]["\x67\145\x74\137\x65\156\x74\151\164\x79"]["\x4e\x41\x4d\x45"] . "\40" . $this->data["\107\105\124\137\105\x4e\x54\111\x54\131\x5f\104\101\124\x41"]["\162\145\163\x75\x6c\x74"]["\x72\x65\163\x75\154\x74"]["\147\145\x74\137\x65\x6e\164\x69\x74\x79"]["\114\101\x53\x54\137\x4e\101\115\105"]; goto petAr; d5_6E: h06EP: goto y4KSq; xrmeq: if (isset($this->data["\107\105\124\x5f\105\116\x54\x49\124\x59\x5f\x44\101\124\x41"]["\x72\x65\163\x75\154\x74"]["\162\145\163\x75\154\x74"]["\147\145\164\x5f\145\156\164\151\164\x79"]["\x54\x49\x54\114\105"])) { goto Yv3Xp; } goto tMw3B; petAr: goto h06EP; goto QAijj; F49xh: } protected function getDescription($description = '') { $result = $this->data["\x4c\111\x4e\105\137\x4e\125\115\102\x45\x52"] . "\x20" . $this->date->format("\x64\56\x6d\56\x59\40\x48\72\151") . "\xa"; return $description === '' ? $result : $description . $result; } protected function getCRMEnt() { goto go0o_; go0o_: switch ($this->data["\103\x52\115\x5f\105\116\124\x49\x54\x59\x5f\124\131\x50\x45"]) { case "\x4c\105\x41\104": $entityCode = "\114\137"; goto aIVE_; case "\x43\x4f\x4e\124\101\103\124": $entityCode = "\x43\x5f"; goto aIVE_; case "\103\117\115\120\101\x4e\x59": $entityCode = "\x43\x4f\x5f"; goto aIVE_; case "\x44\105\101\x4c": $entityCode = "\104\x5f"; goto aIVE_; default: return ''; } goto CEnmo; POVxZ: aIVE_: goto xH2vv; CEnmo: hd7y5: goto POVxZ; xH2vv: return $entityCode . $this->data["\x43\122\x4d\x5f\105\116\x54\x49\x54\131\137\111\104"]; goto ckUce; ckUce: } }
