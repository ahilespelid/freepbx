<?php
 namespace Informunity\Contexts; use Informunity\Classes\ajaxHandler; use Informunity\Classes\Exceptions; use Informunity\Classes\Lines; use Informunity\Classes\OutRoutes; use Informunity\Classes\Users; use Informunity\Log; class MarkOutboundRoute { public static function make(&$ext, $config) { goto QYvRi; V8lRy: gZ5hV: goto irlc6; HTSkK: $seq = self::getSequance(); goto K2tam; K2tam: if (!(!empty($routes) && is_array($routes))) { goto gZ5hV; } goto JvqXw; JvqXw: foreach ($routes as $route) { goto Iq5ff; zbfeE: $outroutingRoutes = static::RouteConfigs($route["\x72\157\x75\164\145\x5f\x69\x64"]); goto fTiFc; fTiFc: $tempRoute = explode("\x2c", $outroutingRoutes); goto y1W2c; Pq3AW: b6YiL: goto F3Y8r; IxYxm: $context = "\x6f\x75\164\x72\164\x2d" . $route["\162\157\165\x74\145\x5f\x69\144"]; goto TpAeT; MhMJ4: $patterns = core_routing_getroutepatternsbyid($route["\162\x6f\165\164\145\137\151\x64"]); goto zbfeE; Jrxpy: J9jJ2: goto g_vXy; F3Y8r: VxNh6: goto Jrxpy; th5yy: $outroutingRoutes = implode("\x2c", $tempRoute); goto Gv8v0; y1W2c: if (!(is_array($tempRoute) && !empty($tempRoute[2]))) { goto dx9NQ; } goto Ji98I; Gv8v0: dx9NQ: goto G9k4Q; Ji98I: $users = Users::getExtensions($config, explode("\x7c", $tempRoute[2])); goto oVY0G; G9k4Q: if (!(!empty($patterns) && is_array($patterns))) { goto VxNh6; } goto OQAbb; OQAbb: foreach ($patterns as $pattern) { goto yC64P; vOzTe: $ext->splice($context, $exten, 3, new \ext_gosub("\61", "\44\x7b\x45\x58\x54\x45\x4e\x7d", "\163\165\x62\55\x6f\x75\164\162\x74\x5f\x49\165\142\62\64", $outroutingRoutes)); goto dX7rz; BieBx: $exten = $fpattern["\x64\151\141\154\x5f\x70\141\164\164\x65\x72\156"]; goto u75xh; yC64P: $fpattern = core_routing_formatpattern($pattern); goto BieBx; NnFM1: zYotI: goto oq9ac; SJG6H: ribZs: goto NnFM1; mxVhc: $add_extra_pri1[$fpattern["\x62\x61\163\x65\x5f\160\141\164\x74\145\x72\156"]] = true; goto SJG6H; u75xh: if (!($fpattern["\142\x61\163\145\137\x70\141\164\164\x65\162\156"] != $exten)) { goto lldaG; } goto vOzTe; MGw_g: $ext->splice($context, $fpattern["\x62\141\x73\x65\137\160\x61\164\x74\145\x72\x6e"], 3, new \ext_gosub("\x31", "\44\x7b\105\x58\x54\105\116\x7d", "\163\165\142\x2d\157\165\164\x72\164\137\x49\x75\x62\62\x34", $outroutingRoutes)); goto uru1D; VlBhN: $ext->splice($context, $exten, 1, new \ext_Noop("\x54\150\151\x73\40\x69\163\72\x20\x22" . $comment . "\x22\x20\162\157\165\x74\145\56\40\101\156\x64\40\160\141\164\164\x65\162\156\40\72" . $exten)); goto X8wFQ; mdITM: if (isset($add_extra_pri1[$fpattern["\142\x61\x73\x65\137\160\141\164\164\x65\162\x6e"]])) { goto ribZs; } goto MGw_g; AK4Mv: lldaG: goto mdITM; dX7rz: $ext->splice($context, $exten, 2, new \ext_set("\x5f\137\x4c\x41\x53\124\x5f\124\x52\x55\116\113", $seq[$route["\162\x6f\165\x74\145\x5f\151\x64"]])); goto VlBhN; ibteY: $ext->splice($context, $fpattern["\142\141\x73\145\x5f\160\x61\164\x74\x65\162\156"], 1, new \ext_Noop("\124\x68\151\x73\40\x69\x73\72\40\x22" . $comment . "\x22\x20\x72\157\165\164\x65\56\x20\x41\156\x64\x20\x70\x61\x74\164\x65\x72\x6e\40\72" . $fpattern["\x62\x61\163\x65\x5f\x70\141\x74\164\x65\162\x6e"])); goto mxVhc; uru1D: $ext->splice($context, $exten, 2, new \ext_set("\137\137\114\101\x53\x54\x5f\124\x52\125\x4e\x4b", $seq[$route["\162\157\165\164\145\x5f\x69\144"]])); goto ibteY; X8wFQ: $add_extra_pri1[$fpattern["\x62\x61\x73\x65\137\x70\x61\x74\x74\145\x72\x6e"]] = true; goto AK4Mv; oq9ac: } goto Pq3AW; Iq5ff: $add_extra_pri1 = array(); goto IxYxm; TpAeT: $comment = $route["\x6e\x61\x6d\145"]; goto MhMJ4; oVY0G: $exceptions = !empty($users) && is_array($users) ? implode("\x7c", $users) : ''; goto itNGq; itNGq: $tempRoute[2] = $exceptions; goto th5yy; g_vXy: } goto U6sst; U6sst: TUxL4: goto V8lRy; QYvRi: $routes = \FreePBX::Core()->getAllRoutes(); goto HTSkK; irlc6: } protected static function RouteConfigs($id) { goto EQnT0; OH3a2: $outrouting["\x62\171\x65"] = $outrouting["\141\x73\x73\145\x73\163\x6d\x65\156\164"] ? recordings_get_file($outrouting["\x62\171\x65"]) : ''; goto L8FxI; GokgF: $outrouting["\x72\157\x75\x74\145\137\151\144"] = $id; goto XanvH; mzAHt: $outrouting["\x67\162\x65\141\x74\x69\x6e\147\x73"] = $outrouting["\141\x73\163\145\163\163\x6d\x65\x6e\x74"] ? recordings_get_file($outrouting["\147\162\x65\141\164\x69\156\x67\x73"]) : ''; goto OH3a2; UVis3: $outrouting["\x6d\x6f\x64\x69\146\171\137\156\x75\x6d\x62\x65\x72"] = empty($outrouting["\x6d\157\x64\x69\x66\x79\137\x6e\165\155\142\x65\162"]) ? "\44\x7b\105\x58\124\105\116\x7d" : $outrouting["\x6d\157\x64\151\x66\x79\137\156\165\x6d\142\x65\162"]; goto zkPK3; D4wkQ: wuipU: goto WKrR1; L8FxI: $outrouting["\x64\145\163\143\162\151\x70\164\151\157\156"] = preg_replace("\57\54\57", "\56", $outrouting["\144\145\x73\x63\x72\x69\160\164\151\x6f\x6e"]); goto UVis3; EQnT0: $outrouting = OutRoutes::load()->getRouteOutboundByID($id); goto TRQ7p; ohe5n: $outrouting["\160\162\x65\146\x69\x78\145\163"] = Lines::load()->GetOutboundRoutesPrefixesById($id); goto mzAHt; XanvH: $outrouting["\x65\170\x63\145\x70\164\151\x6f\156\x73"] = Exceptions::load()->getExceptionByID($outrouting["\145\170\x63\x65\x70\x74\151\157\156\x73"]); goto ohe5n; zkPK3: return implode("\54", array_values(array($outrouting["\x72\157\x75\164\x65\x5f\x69\x64"], $outrouting["\163\150\x6f\x77\137\x63\141\162\144"], $outrouting["\145\x78\143\x65\160\164\151\x6f\x6e\163"], $outrouting["\147\x72\145\x61\164\x69\156\147\163"], $outrouting["\x62\x79\145"], $outrouting["\160\x72\145\x66\151\170\145\163"], $outrouting["\x6d\157\144\151\146\171\x5f\x6e\165\155\x62\x65\162"]))); goto D4wkQ; WKrR1: return ''; goto ves8S; TRQ7p: if (!(!empty($outrouting) && is_array($outrouting) && isset($outrouting["\x73\x74\x61\164\165\163"]) && $outrouting["\x73\164\x61\x74\x75\163"])) { goto wuipU; } goto GokgF; ves8S: } protected static function getRouteTrunks() { goto uEbRZ; oD4XZ: return array(); goto ByY6v; EPqFY: foreach ($result as $record) { $response[$record["\x72\157\x75\x74\x65\x5f\x69\144"]][$record["\x73\145\x71"]] = $record["\x74\162\165\156\153\137\151\x64"]; FXSKo: } goto DTfco; ByY6v: yvMA8: goto v7tQa; DTfco: EwlHF: goto Sk77E; zrs_8: $sth = $DB->prepare($sql); goto KKqb8; C7bZr: hAsFd: goto EPqFY; KKqb8: $sth->execute(); goto vZMUN; lmeIE: return array(); goto C7bZr; uEbRZ: $response = array(); goto jDXN1; v7tQa: if (is_array($result)) { goto hAsFd; } goto lmeIE; vZMUN: $result = $sth->fetchAll(\PDO::FETCH_ASSOC); goto fhhiq; Sk77E: return $response; goto Cg2m6; fhhiq: if (!empty($result)) { goto yvMA8; } goto oD4XZ; p4hK8: $sql = "\x53\x45\114\105\x43\124\40\52\40\x46\122\117\x4d\40\140\x6f\x75\164\x62\x6f\x75\156\144\x5f\162\157\x75\x74\145\137\x74\162\165\x6e\x6b\163\x60\40\117\122\x44\105\122\x20\102\131\x20\163\145\x71"; goto zrs_8; jDXN1: $DB = \FreePBX::Database(); goto p4hK8; Cg2m6: } protected static function getSequance() { goto kfaik; AvwnK: foreach ($routeTable as $route => $trunks) { goto rKJd9; eRYD8: foreach ($trunks as $trunk) { goto EJSxt; C4N7k: if (!($trunk_table[$trunk]["\x63\157\156\x74\x69\x6e\165\145"] != "\157\156")) { goto R0XjF; } goto lGYGS; EJSxt: $response[$route][] = $trunk; goto C4N7k; lGYGS: goto g7ZzK; goto nXgh_; VfTeN: t4s52: goto AwmPW; nXgh_: R0XjF: goto VfTeN; AwmPW: } goto siwun; rKJd9: if (!(empty($trunks) || !is_array($trunks))) { goto m2oSk; } goto vyvCW; siwun: g7ZzK: goto YqIhG; YqIhG: $response[$route] = array_pop($response[$route]); goto fJGQr; fJGQr: SjraZ: goto vCavk; OIBiJ: m2oSk: goto eRYD8; vyvCW: goto SjraZ; goto OIBiJ; vCavk: } goto MgTMS; Stl0e: $trunk_table = core_trunks_listbyid(); goto PevdM; PevdM: if (!(empty($routeTable) || !is_array($routeTable))) { goto Hj3tU; } goto J9Nq3; J9Nq3: return array(); goto MuKZU; kfaik: $response = array(); goto rCDsw; MuKZU: Hj3tU: goto AvwnK; rCDsw: $routeTable = self::getRouteTrunks(); goto Stl0e; LHUak: return $response; goto VKIAo; MgTMS: sb1YP: goto LHUak; VKIAo: } }
