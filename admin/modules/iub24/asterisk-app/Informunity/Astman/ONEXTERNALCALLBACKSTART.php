<?php
 namespace Informunity\Astman; use Informunity\Classes\Callbacks; use Informunity\Classes\Lines; use Informunity\Log; class ONEXTERNALCALLBACKSTART { protected $config; protected $astman; protected $Log; protected $arData; protected $callerID; protected $ClientNumber; protected $LINE_NUMBER; protected $CRM_ENTITY_TYPE; protected $CRM_ENTITY_ID; protected $destination; public static function Load($config) { return Custom::GetCustomData($config, __CLASS__); } public function __construct($config) { goto ifN0Z; lqlDp: $this->config = $config; goto uJkt1; uJkt1: $this->astman = $astman; goto Rhq_S; ifN0Z: global $astman; goto lqlDp; Rhq_S: } public function Run($arData) { goto Jp25N; VIHix: $this->LINE_NUMBER = $arData["\144\x61\x74\141"]["\114\111\116\105\x5f\x4e\125\x4d\x42\105\122"]; goto QnS2R; oa5JC: $this->arData = $arData; goto b2XbS; drWYy: $status = $this->astman->originate($originate_array); goto Ee8ol; Jp25N: $this->Log = new Log(array("\150\145\x61\144\x65\162" => "\122\145\x71\165\x65\x73\x74\x20\x66\x72\x6f\155\40\x42\x69\164\x72\x69\170\40", "\141\163\x74\145\x72\151\163\153\137\143\141\154\x6c\151\x64" => "\x5b\117\116\105\x58\124\105\x52\x4e\101\x4c\x43\101\114\x4c\x42\101\x43\x4b\x53\x54\x41\x52\124\x5d"), $this->config["\x6c\x6f\147\x67\151\156\x67"]); goto BlhB7; QnS2R: $this->CRM_ENTITY_TYPE = $arData["\x64\141\x74\x61"]["\103\122\x4d\137\x45\x4e\x54\x49\124\x59\x5f\124\x59\120\x45"]; goto DfOIi; NbISn: $this->setClientNumber(); goto FGaF6; RRIY3: return "\146\x61\154\163\145"; goto NnmFF; b2XbS: $this->callerID = preg_replace("\57\50\77\41\x5e\x5c\53\51\134\104\53\57", '', $arData["\144\141\x74\x61"]["\120\x48\117\x4e\105\137\116\125\115\x42\105\x52"]); goto VIHix; soQ8m: zK_2g: goto HBqNd; NnmFF: laIqJ: goto NbISn; E_MF3: return "\x66\x61\154\163\x65"; goto soQ8m; BlhB7: $this->Log->toFile($arData); goto oa5JC; FGaF6: if (!$this->noRoute()) { goto zK_2g; } goto E_MF3; Qr_VJ: if (!($this->isLocalNumber() || !$this->setDestination())) { goto laIqJ; } goto RRIY3; DfOIi: $this->CRM_ENTITY_ID = $arData["\144\141\x74\141"]["\103\x52\x4d\137\x45\116\x54\111\124\131\137\x49\x44"]; goto Qr_VJ; Ee8ol: $this->Log->toFile($status); goto BIBOj; uXvr1: $this->Log->toFile($originate_array); goto drWYy; HBqNd: $originate_array = $this->getCommand(); goto uXvr1; BIBOj: } protected function getCommand() { $dest = explode("\x2c", $this->destination); return array("\x43\150\141\156\156\145\154" => "\114\x6f\143\141\x6c\x2f" . $dest[1] . "\x40" . $dest[0] . "\57\x6e", "\105\x78\x74\145\156" => $this->ClientNumber, "\x43\x6f\x6e\164\145\170\x74" => "\146\x72\157\155\55\143\141\x6c\154\x62\141\143\153", "\x50\x72\x69\x6f\x72\151\x74\171" => 1, "\103\x61\x6c\x6c\145\x72\x49\x44" => "\x43\141\154\154\x42\x61\143\x6b\40" . $this->LINE_NUMBER . "\x3a" . $this->callerID . "\x3c" . $this->callerID . "\76", "\x56\x61\x72\151\x61\x62\154\x65" => "\137\137\x44\x49\122\x45\103\124\x49\117\x4e\75\103\x41\x4c\114\102\101\103\113\54\137\137\105\116\124\x49\x54\x59\137\124\131\120\x45\x3d" . $this->CRM_ENTITY_TYPE . "\x2c\x5f\x5f\105\116\x54\x49\x54\x59\x5f\111\x44\75" . $this->CRM_ENTITY_ID, "\x41\163\x79\x6e\143" => "\164\x72\165\145"); } protected function isLocalNumber() { goto GkXdK; GkXdK: $localNumber = strlen($this->callerID) <= 4; goto tz2pE; gTMtP: $this->Log->toFile(array("\x45\122\x52\x4f\x52" => "\x43\x61\156\47\x74\40\143\x61\x6c\154\142\141\143\153\40\164\x6f\x20\x69\x6e\x74\x65\162\156\x61\x6c\x20\x6e\165\155\x62\x65\x72")); goto FfO5m; FfO5m: kuZF0: goto n9cf7; tz2pE: if (!$localNumber) { goto kuZF0; } goto gTMtP; n9cf7: return $localNumber; goto szTWR; szTWR: } protected function setDestination() { goto noRIR; mg3PE: if ($this->destination) { goto hy5vM; } goto Q1snz; Q1snz: $this->Log->toFile(array("\105\122\122\x4f\x52" => "\x43\x61\156\x27\x74\40\x64\145\x74\145\162\155\151\156\141\x74\145\40\154\151\156\x65\x20\156\x75\155\142\x65\x72\40\x6f\x72\x20\x64\x65\x73\x74\x69\156\141\164\x69\x6f\x6e\x20\x6e\157\164\40\x73\x65\x74")); goto eT9DQ; dn07v: return $this->destination; goto gOugV; noRIR: $this->destination = Callbacks::load()->getCallBackByLineNumber($this->LINE_NUMBER); goto mg3PE; eT9DQ: hy5vM: goto dn07v; gOugV: } protected function setClientNumber() { $prefix = Lines::load()->getPrefixByNumber($this->LINE_NUMBER); $this->ClientNumber = !empty($prefix) ? $prefix . preg_replace("\57\x5c\x2b\x2f", '', $this->callerID) : $this->callerID; } protected function noRoute() { goto RJOTm; qeY0C: if ($route) { goto OmSB2; } goto wqMEJ; bSw8Z: OmSB2: goto wmgEj; RJOTm: $route = !$this->config["\162\x6f\165\164\x65\x43\150\x65\143\x6b"] || checkOutboundRoute::Run($this->config, $this->ClientNumber); goto qeY0C; wmgEj: return !$route; goto zaPo2; wqMEJ: $this->Log->toFile("\x21\x52\117\x55\124\105\x20\116\x4f\124\40\106\x4f\125\x4e\x44\41"); goto bSw8Z; zaPo2: } }
