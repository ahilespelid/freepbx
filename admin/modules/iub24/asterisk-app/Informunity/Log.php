<?php
 namespace Informunity; class Log { private $callID = null; private $Header = null; private $version = ''; private $ID = ''; private $disabled; public function __construct($array, $disabled = "\61") { goto TY7CS; E6g8y: $this->ID = $date->getTimestamp() . "\x2d" . rand(1000, 2000); goto Lnj79; gwCbn: goto uhQmE; goto c_fiR; OX_tG: $this->Header = $array["\150\145\x61\144\x65\162"]; goto bLz8P; Lq8EP: $ver = $modulef->getinfo("\151\165\142\x32\64"); goto alSNY; bLz8P: uhQmE: goto LolOw; ohn5r: $date = new \DateTime(); goto E6g8y; TY7CS: $this->disabled = $disabled == "\61"; goto O39T4; bOSyb: $this->callID = $array; goto gwCbn; alSNY: $this->version = $ver["\x69\165\x62\x32\64"]["\x76\145\162\x73\151\x6f\156"]; goto jNW7s; Lnj79: if (is_array($array)) { goto GN96M; } goto bOSyb; c_fiR: GN96M: goto ZqHl1; jNW7s: F0xVC: goto p_YVd; LolOw: $modulef = \FreePBX::module_functions(); goto Lq8EP; O39T4: if ($this->disabled) { goto F0xVC; } goto ohn5r; ZqHl1: $this->callID = $array["\141\163\x74\145\162\x69\163\x6b\137\x63\141\x6c\x6c\151\x64"]; goto OX_tG; p_YVd: } private static function getFiles() { goto EeEg4; xoq0q: if (empty($status)) { goto SmsOZ; } goto cctj7; QIs5y: k2g1t: goto yf0Yt; hHu5j: $q = $db->prepare($sql); goto SmvGb; EeEg4: $name = false; goto KVPiJ; p4_OS: $status = $q->fetchAll(); goto xoq0q; SmvGb: $q->execute(); goto p4_OS; SdrIa: return $name; goto OHnWz; q8ffC: $sql = "\123\105\x4c\x45\x43\124\40\x6e\x61\155\145\12\40\40\x20\x20\40\40\40\x20\40\x20\40\40\40\40\x20\x20\106\x52\117\115\40\154\x6f\147\x66\x69\x6c\145\x5f\154\x6f\x67\146\151\154\x65\163\40\12\40\40\x20\x20\40\x20\x20\x20\x20\x20\40\40\x20\40\40\x20\127\110\x45\x52\x45\40\156\141\155\x65\40\41\75\x20\47\x63\x6f\156\163\x6f\154\x65\x27\40\x41\x4e\104\x20\166\145\162\x62\157\x73\145\x20\41\75\x20\47\157\146\146\x27\73\xa\40\40\x20\40\40\40\x20\40\x20\40\40\40\40\x20\40\x20"; goto hHu5j; cctj7: global $amp_conf; goto l7Sib; KVPiJ: $db = \FreePBX::Database(); goto q8ffC; yf0Yt: SmsOZ: goto SdrIa; l7Sib: foreach ($status as $names) { $name[] = $amp_conf["\101\x53\x54\x4c\117\107\104\111\122"] . "\57" . $names[0]; Y3d5b: } goto QIs5y; OHnWz: } public static function toOutput($var) { goto goTkR; W7WJO: echo "\x5b" . $date . "\x5d\x3c\x62\162\x3e\57"; goto BE84n; BE84n: var_export($var, true); goto Py_31; goTkR: $date = date("\x59\x2d\155\55\144\40\110\x3a\151\72\x73"); goto W7WJO; Py_31: } public static function Debug($data, $file = '') { goto LH7wv; LH7wv: if (empty($data)) { goto KDmlF; } goto Rt2sj; nQvdu: foreach ($files as $file) { try { goto hHcE8; hHcE8: file_put_contents($file, "\12", FILE_APPEND); goto oVMTt; naeyz: file_put_contents($file, json_encode($data) . "\12", FILE_APPEND); goto nMVi7; nMVi7: file_put_contents($file, json_encode("\55\x2d\x2d\x2d\55\x2d\55\55\x2d\55\55\55\55\55\55\55\x2d\55\55\x2d\55\x2d\x2d\x2d\x2d\55\55\55\55\x2d\55\x2d\55\55\x2d\55\x2d\x2d\55\55\55") . "\xa", FILE_APPEND); goto Ti6bo; oVMTt: file_put_contents($file, json_encode("\55\55\55\55\55\55\55\55\x2d\x2d\x2d\55\55\55\x2d\x2d\55\55\55\x2d\55\55\x2d\x2d\x2d\55\x2d\x2d\x2d\55\x2d\x2d\55\x2d\55\55\x2d\x2d\x2d\x2d") . "\12", FILE_APPEND); goto naeyz; Ti6bo: file_put_contents($file, "\xa", FILE_APPEND); goto hwdsp; hwdsp: } catch (\Exception $e) { } vNFS2: } goto jkgo4; ppgsd: if (!$files) { goto wJ3jP; } goto nQvdu; Iqj1a: KDmlF: goto kHF5C; jkgo4: skRqg: goto gj4se; gj4se: wJ3jP: goto Iqj1a; Rt2sj: $files = empty($file) ? static::getFiles() : array($file); goto ppgsd; kHF5C: } public function toFile($data) { goto KFtkX; ajXtl: $date = date("\x59\x2d\155\x2d\144\x20\110\72\x69\72\x73"); goto XcH5B; XcH5B: static::FileWrite("\x5b" . $date . "\x5d" . $this->callID . "\133" . $this->ID . "\x5d\x5b" . $this->Header . "\135\x5b" . $this->version . "\x5d\133\55\102\145\x67\x69\x6e\55\x5d\12"); goto jMYpX; nZ820: msN1X: goto LHOwx; FbWDo: static::FileWrite("\x5b" . $date . "\135" . $this->callID . "\x5b" . $this->ID . "\x5d\x5b" . $this->Header . "\135\133\x2d\105\156\144\x2d\135\xa"); goto nZ820; jMYpX: $this->parseLogArray($data, $date); goto FbWDo; KFtkX: if ($this->disabled) { goto msN1X; } goto ajXtl; LHOwx: } protected function parseLogArray($data = '', $date, $suffix = '') { goto nlD1W; t2PoB: unset($data["\x66\151\x6c\x65\x44\x61\164\141"][1]); goto KpjkL; NaLCF: wwpe_: goto pQhMT; o1CkG: if (!(!empty($data["\x66\x69\154\x65\104\141\164\x61"]) && !is_string($data["\146\151\154\x65\104\141\x74\141"]))) { goto GVP4n; } goto t2PoB; KpjkL: GVP4n: goto qr2qk; qr2qk: foreach ($data as $str => $val) { goto WPlvN; igizN: if (is_array($val)) { goto nX9Ex; } goto KsVRr; LOweb: z73B3: goto hIJqF; KsVRr: if (!($str != "\x46\x49\x4c\105\x5f\103\x4f\x4e\x54\x45\x4e\x54\x3a")) { goto rcVE_; } goto zmbw1; FSVAH: goto z73B3; goto Vtek4; WPlvN: if (!preg_match("\x2f\x67\x65\x74\137\165\x73\145\162\x2f", $str)) { goto Lipe1; } goto x6PEh; x6PEh: goto oUeZB; goto BTw_J; zmbw1: $this->FileWrite("\133" . $date . "\x5d" . $this->callID . "\x5b" . $this->ID . "\x5d\40" . $suffix . $str . "\40\75\x3e\40" . $val . "\xa"); goto yEaRz; qtCQz: $this->parseLogArray($val, $date, $str === "\162\x65\163\x75\x6c\164" || $str === "\162\x65\163\x75\x6c\164\x5f\164\151\155\145" ? "\40\x20\40\40" : $suffix . $str . "\40"); goto LOweb; yEaRz: rcVE_: goto FSVAH; Vtek4: nX9Ex: goto qtCQz; BTw_J: Lipe1: goto igizN; hIJqF: oUeZB: goto CW3AH; CW3AH: } goto gdcJI; gdcJI: Qq7IQ: goto NaLCF; urH3C: goto wwpe_; goto aVaCu; nlD1W: if (is_array($data)) { goto JUZgy; } goto LKbIA; LKbIA: $this->FileWrite("\133" . $date . "\x5d" . $this->callID . "\x5b" . $this->ID . "\x5d\x20" . $suffix . "\40" . $data . "\12"); goto urH3C; aVaCu: JUZgy: goto o1CkG; pQhMT: } protected static function FileWrite($data) { goto YeDUK; Kd2Kz: $files = static::getFiles(); goto uK3Lp; uK3Lp: if (!$files) { goto kvrTD; } goto tm7Jp; RPS2s: WyaBf: goto AjuYM; YeDUK: if (empty($data)) { goto WyaBf; } goto Kd2Kz; tO2h1: rvtXx: goto tNumV; tNumV: kvrTD: goto RPS2s; tm7Jp: foreach ($files as $file) { try { file_put_contents($file, $data, FILE_APPEND); } catch (\Exception $e) { } Dm_Ko: } goto tO2h1; AjuYM: } }
